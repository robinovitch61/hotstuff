{"version":3,"sources":["config.ts","components/Sidebar/EditableTable/style.tsx","components/Sidebar/EditableTable/TableHeader.tsx","components/Sidebar/EditableTable/cells/DropDownTableCell.tsx","components/Sidebar/style.tsx","components/Sidebar/EditableInput.tsx","components/Sidebar/EditableStringInput.tsx","components/Sidebar/EditableTable/cells/TextTableCell.tsx","components/Sidebar/EditableNumberInput.tsx","components/Sidebar/EditableTable/cells/NumericalTableCell.tsx","components/Sidebar/EditableTable/cells/BooleanTableCell.tsx","components/Sidebar/EditableTable/TableCell.tsx","components/Sidebar/EditableTable/hooks/useSortableTable.ts","components/Sidebar/EditableTable/DeleteCell.tsx","utils/nodeConnectionUtils.ts","components/Sidebar/EditableTable/NodeTable/NodeTable.tsx","components/Sidebar/EditableTable/ConnectionTable/ConnectionTable.tsx","components/Tabs/Tabs.tsx","utils/pointUtils.ts","default.ts","components/Sidebar/ModelControls.tsx","components/Sidebar/hooks/useTemporaryError.tsx","components/Modal/style.tsx","components/Modal/ErrorModal.tsx","components/Sidebar/Sidebar.tsx","components/Plot/LinePlot.tsx","components/Plot/Plot.tsx","components/Canvas/canvasUtils.ts","components/Canvas/hooks/usePanZoomCanvas.ts","components/Canvas/CanvasControls.tsx","components/Canvas/ModalControls.tsx","components/Canvas/Canvas.tsx","components/Canvas/hooks/useOnClickCanvas.ts","hooks/useDraw.ts","hooks/useAddConnection.ts","hooks/useMoveNode.ts","hooks/useMultiSelect.ts","hooks/useOnMouseDown.ts","hooks/useClickAndDragElement.ts","hooks/useResizablePanels.ts","style.tsx","components/Modal/ConfirmationModal.tsx","components/Modal/TheoryModal.tsx","components/Modal/Modal.tsx","hooks/useOnClickOutside.ts","App.tsx","hooks/useSessionStorageState.ts","hooks/useAppStateModifiers.ts","hooks/useNodeConnectionUtils.ts","hooks/useKeyDown.ts","hooks/useDoubleClick.ts","components/Canvas/hooks/useWindowSize.ts","utils/scrollBar.ts","index.tsx"],"names":["config","maxTimeSteps","defaultTempDegC","defaultCapJPerDegK","defaultPowerGenW","defaultTotalTimeSeconds","defaultTimeStepSeconds","defaultNodeName","defaultNodeRadius","defaultResistanceDegKPerW","defaultSmallResistanceDegKPerW","defaultEditorWidthFraction","defaultCanvasHeightFraction","defaultTableHeightFraction","minPanelFraction","newNodeNamePrefix","zoomSensitivity","minZoom","maxZoom","maxZoomDelta","minRadiusPx","maxRadiusPx","activeNodeOutlineWidthPx","tabHeightPx","plotHeightBufferPx","tableDeleteCellWidthPercent","tableDeleteCellMinWidthPx","plotMargin","left","right","top","bottom","plotDomainMarginPercent","maxPlotPoints","multiSelectKeys","errorMessageDurationSeconds","StyledTableWrapper","styled","div","StyledTable","StyledTableBody","StyledAddButton","button","StyledRow","heightOffsetPx","isActive","StyledCell","width","minWidth","StyledDeleteCell","StyledHeaderWrapper","StyledColHeader","StyledColText","StyledSortIcon","TableHeader","props","columns","sortState","setSortState","sortIcon","direction","map","col","isSortedCol","key","onClick","sortDirection","minWidthPx","text","toString","style","cursor","StyledSelect","select","DropDownTableCell","value","setOption","id","onChange","event","newVal","target","selectedOption","options","find","option","undefined","onSelectOption","rowId","StyledInput","input","StyledEditor","height","StyledTables","heightFrac","StyledModelControlsWrapper","EditableInput","initialValue","onBlur","getNewValue","afterValue","validator","inputRef","useRef","withAfterValue","useCallback","val","useState","setValue","handleOnBlur","validated","prevVal","ref","type","onFocus","replace","onKeyDown","includes","current","blur","EditableStringInput","TextTableCell","initialVal","getFloatVal","newValueText","newValueFloat","parseFloat","isNaN","EditableNumberInput","NumericalTableCell","StyledCheckbox","BooleanTableCell","initialIsActive","setIsActive","tabIndex","onKeyUp","showWhenActive","TableCell","row","onUpdateRow","initiallySetOption","length","useSortableTable","defaultSortState","tieBreakerKey","ultraSuperDuperTieBreakerKey","first","second","DeleteCell","onDeleteRow","ALL_CONNECTION_KINDS","DO_NOT_PAIR_KINDS","getExistingConnections","firstNodeId","secondNodeId","connections","filter","conn","firstNode","secondNode","makeNewConnection","kind","resistance","firstNodeFirst","name","makeConnection","resistanceDegKPerW","getNewConnection","existingConnections","existingKinds","remainingKinds","every","k","some","newNodeName","i","getNewAppNode","appNodes","center","allNodeNames","node","newNode","makeNode","temperatureDegC","capacitanceJPerDegK","powerGenW","isBoundary","textDirection","getConnectionAfterValue","filterConnectionOptions","colKey","selectedConnection","otherConnections","filterKey","allOtherConnections","filteringFirstNode","otherConnection","isIllegalConnectionKindCombo","filterFirstAndSecondNodeOptions","possibleKinds","connectionKind","getNewConnectionKindsPossible","opt","defaultNodeSortState","NodeTable","rows","onAddButton","setTemporaryErrors","sortByState","nodeColumns","useMemo","otherNames","trimName","trim","safeName","safeAllNames","n","makeNewName","validateNodeName","r","tempVal","KELVIN","tableRows","sort","tableCell","defaultConnectionSortState","connectionTypes","ConnectionTable","nodes","onSelectNewfirstNode","connection","newfirstNodeNode","onSelectNewsecondNode","newsecondNodeNode","onSelectNewConnectionType","rowToUpdate","nodeOptions","connectionColumns","resistanceNumber","activeNodeIds","cols","makeStyledCell","StyledTabsWrapper","StyledTabs","StyledTab","StyledTabText","StyledInnerContent","Tabs","activeIdx","setActiveIdx","tabs","tab","idx","className","topLeftRounded","_","component","ORIGIN","Object","freeze","x","y","diffPoints","p1","p2","scalePoint","scale","jerryNode","jerryAppNode","bedNode","bedAppNode","airNode","defaultNodes","defaultConnections","defaultTiming","timeStepS","totalTimeS","defaultCanvasViewState","offset","defaultPanelSizes","editorWidthFraction","canvasHeightFraction","tableHeightFraction","defaultModalState","visible","defaultAppState","timing","canvasViewState","savedCanvasState","panelSizes","StyledButton","StyledAnchor","a","StyledImport","StyledTopControls","StyledTimeControls","StyledTimeControl","StyledInputWrapper","StyledLabel","label","ModelControls","appState","setAppState","setOutput","setModalState","onRunModel","setTiming","stagedAppState","setStagedAppState","downloadModelRef","newTotalTimeS","newTimeStepS","navigator","clipboard","writeText","JSON","stringify","newOutput","blob","Blob","url","URL","createObjectURL","setAttribute","now","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","parse","prev","onConfirm","confirmText","useTemporaryError","errors","setErrors","setTimeout","StyledExitButton","StyledError","isVisible","ErrorModal","err","Sidebar","onAddNode","onAddConnection","updateNodes","deleteNodes","updateConnections","deleteConnections","tableErrors","setTableErrors","setTemporaryTableErrors","modelControlsErrors","setModelControlsErrors","setTemporaryModelControlsErrors","nodeTable","connectionTable","Math","ceil","StyledToolTip","StyledToolTipTitle","StyledToolTipItem","color","StyledToolTipValue","after","CustomTooltip","active","payload","sortedPayload","b","item","LinePlot","plotDimensions","plotData","lines","xAxisKey","xLabel","yLabel","yDomain","unit","LineChart","margin","data","CartesianGrid","strokeDasharray","XAxis","dataKey","position","dy","YAxis","domain","angle","dx","Tooltip","content","Legend","layout","verticalAlign","align","wrapperStyle","paddingLeft","paddingBottom","colors","StyledCharts","StyledPlot","roundToNearestTenth","round","plotShape","lowerMag","floor","log10","divisibleBy","pow","includeAll","timeSeriesS","tempsAtAllTimes","minTemp","maxTemp","heatTransfersAtAllTimes","minHeatTransfer","maxHeatTransfer","forEach","t","abs","temp","time","ht","nodeResults","nodeResult","tempDegC","connectionResults","connectionResult","heatTransferVal","heatTransferW","push","Plot","modelHasOutput","modelOutput","res","emptyOutput","tempPlotData","tempDomain","heatTransferPlotData","heatTransferDomain","yTempDomainMargin","yTempDomain","yHeatTransferDomainMargin","yHeatTransferDomain","heatTransferLines","Line","stroke","activeDot","isAnimationActive","tempLines","tempPlot","heatTransferPlot","DEFAULT_RADIUS","drawNode","context","radius","save","beginPath","arc","PI","fillStyle","fill","closePath","restore","drawCircle","lineWidth","strokeStyle","drawCircleOutline","translate","rotate","moveTo","lineTo","h","newRadius","sin","acos","drawHashPattern","font","textMetrics","measureText","fillText","actualBoundingBoxAscent","actualBoundingBoxDescent","drawNodeName","drawConnection","firstNodeCenter","firstNodeRadius","secondNodeCenter","secondNodeRadius","start","end","startOffset","endOffset","headLength","headWidth","arrowGap","atan2","adjLength","sqrt","drawBidirectionalArrow","drawUnidirectionalArrow","intersectsCircle","point","circleCenter","deltaX","deltaY","calculateMousePositionOnElement","element","viewportMousePos","pageX","pageY","boundingRect","getBoundingClientRect","mouseToNodeCoords","canvasState","canvasMouse","canvas","mouse","determineRadius","capacitance","allCapacitances","min","max","StyledButtons","CanvasControls","setCanvasViewState","setSavedCanvasState","StyledModalControls","StyledModalControlButton","ModalControls","StyledCanvasWrapper","StyledCanvas","cssWidth","cssHeight","Canvas","onClickCanvas","canvasWidth","canvasHeight","devicePixelRatio","draw","onMouseDown","handleDoubleClick","savedCanvasViewState","setSavedCanvasViewState","setKeyboardActive","canvasRef","useEffect","handleClickOutside","keyBoardActive","contains","document","addEventListener","removeEventListener","setContext","mousePosRef","lastMousePosRef","lastCanvasViewState","mouseMove","newMousePos","mouseDiff","newCanvasViewState","mouseUp","startPan","useLayoutEffect","handleWheel","preventDefault","zoomDelta","zoom","newScale","mouseOffset","canvasElem","usePanZoomCanvas","renderCtx","getContext","onDoubleClick","useDraw","appConnections","nodeRadius","nodeColor","temperature","allTemperatures","range","scaleDiverging","test","determineColor","firstNodeAppNode","secondNodeAppNode","clearAndRedraw","clearRect","useAddConnection","addConnection","drawConnectionBeingMade","clickedNode","nodeCoordsOfMouse","drawArrowWithoutHead","drawConnWrapper","mouseUpOnNode","newConnection","getNewAppNodes","clickedMouseEvent","currentMouseEvent","multiSelectKeyPressed","activeNodes","offsetMouseToCenter","newClickedCenter","newClickedNode","newActiveNodes","distanceFromClickedCenter","useMultiSelect","setActiveNodes","boxStart","drawBox","globalAlpha","fillRect","rect","boxEnd","startBox","endBox","topLeft","bottomRight","bottomLeft","topRight","isInsideBox","useOnMouseDown","clearActiveNodes","moveNode","movedRef","mouseDownEvent","newNodes","mouseUpEvent","useMoveNode","multiSelect","defaultBehavior","altKey","onMouseUp","clientX","clientY","useClickAndDragElement","params","lastMousePos","onDragX","onDragY","constrainX","constrainY","onMouseMove","mouseMoveEvent","currentMousePos","diff","constrainPanelSize","newPanelSize","StyledApp","modalOpen","StyledDraggableBorder","StyledHorizontalBorder","StyledVerticalBorder","StyledWorkspace","StyledConfirmationModal","StyledConfirmationText","p","StyledConfirmationButtons","StyledConfirmationButton","ConfirmationModal","modalState","StyledTheoryModal","StyledTitle","h1","StyledText","StyledLink","StyledListItem","li","TheoryModal","href","display","tex","String","raw","StyledModal","Modal","onClickOutside","modalRef","listener","modalContent","getModalContent","prevState","App","defaultValue","React","localState","window","sessionStorage","getItem","setItem","useSessionStorageState","output","appErrors","setAppErrors","setTemporaryAppErrors","newConnections","newCanvasState","newSavedCanvasState","newTiming","useAppStateModifiers","setAppNodes","setAppConnections","addNode","nodesToUpdate","prevConn","nodeToUpdate","nodeIds","connsToUpdate","sortedConnsToUpdate","connIdsToUpdate","oldConns","connIds","useNodeConnectionUtils","keyboardActive","metaKey","keyCode","useKeyDown","doubleClickedNode","newAppNode","useDoubleClick","size","setSize","ratio","setRatio","updateSize","innerWidth","innerHeight","updateRatio","useWindowSize","windowWidth","windowHeight","newX","minPx","maxPx","newY","deltaYPx","prevAppState","deltaXPx","useResizablePanels","canvasPlotBorderRef","onMouseDownOnCanvasPlotBorder","leftRightBorderRef","onMouseDownOnLeftRightBorder","tableControlsBorderRef","onMouseDownOnTableControlsBorder","workspaceWidth","workspaceHeight","plotHeight","plotWidth","editorWidth","plot","addNodeInCenterOfCanvas","topLeftPoint","getCanvasCenter","createNewLogicalConnection","getNewPossibleConnection","conns","run","message","scrollableElem","createElement","innerElem","overflow","borderWidth","appendChild","body","offsetWidth","clientWidth","removeChild","areScrollbarsVisible","classList","add","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.1ceb2659.chunk.js","sourcesContent":["type MouseEventKey = \"shiftKey\" | \"altKey\" | \"metaKey\" | \"ctrlKey\";\n\nconst config = {\n  maxTimeSteps: 100000,\n  defaultTempDegC: 23,\n  defaultCapJPerDegK: 10,\n  defaultPowerGenW: 0,\n  defaultTotalTimeSeconds: 600,\n  defaultTimeStepSeconds: 0.1,\n  defaultNodeName: \"Unnamed\",\n  defaultNodeRadius: 20,\n  defaultResistanceDegKPerW: 10,\n  defaultSmallResistanceDegKPerW: 0.01,\n  defaultEditorWidthFraction: 1 - 1 / 1.61803398875,\n  defaultCanvasHeightFraction: 1 / 1.61803398875,\n  defaultTableHeightFraction: 0.5,\n  minPanelFraction: 0.1,\n  newNodeNamePrefix: \"New Node\",\n  zoomSensitivity: 1500, // bigger = less zoom per click\n  minZoom: 0.5,\n  maxZoom: 2,\n  maxZoomDelta: 2,\n  minRadiusPx: 20,\n  maxRadiusPx: 40,\n  activeNodeOutlineWidthPx: 5,\n  tabHeightPx: 25,\n  plotHeightBufferPx: 10,\n  tableDeleteCellWidthPercent: 0.1,\n  tableDeleteCellMinWidthPx: 40,\n  plotMargin: {\n    left: 10,\n    right: 20,\n    top: 20,\n    bottom: 20,\n  },\n  plotDomainMarginPercent: 0.1,\n  maxPlotPoints: 400,\n  multiSelectKeys: [\"metaKey\", \"ctrlKey\"] as MouseEventKey[],\n  errorMessageDurationSeconds: 4,\n};\n\nexport default config;\n","import styled from \"styled-components/macro\";\n\nexport const StyledTableWrapper = styled.div`\n  width: 100%;\n`;\n\nexport const StyledTable = styled.div`\n  width: 100%;\n  border-collapse: collapse;\n`;\n\nexport const StyledTableBody = styled.div`\n  width: 100%;\n`;\n\nexport const StyledAddButton = styled.button``;\n\nexport const StyledRow = styled.div<{\n  heightOffsetPx?: number;\n  isActive: boolean;\n}>`\n  display: inline-flex;\n  align-items: center;\n  min-width: 100%;\n  position: sticky;\n  top: ${({ heightOffsetPx }) =>\n    heightOffsetPx ? `${heightOffsetPx}px` : \"0px\"};\n  background: ${({ isActive }) =>\n    isActive ? \"rgba(112, 165, 255, 0.2)\" : \"none\"};\n`;\n\nexport const StyledCell = styled.div<{ width: number; minWidth?: number }>`\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  border: 1px solid #ddd;\n  height: 2em;\n  width: ${({ width }) => `${width * 100}%`};\n  min-width: ${({ minWidth }) => (!!minWidth ? `${minWidth}px` : \"none\")};\n`;\n\nexport const StyledDeleteCell = styled(StyledCell)`\n  cursor: pointer;\n  user-select: none;\n  min-width: 40px;\n\n  &:hover {\n    background: black;\n  }\n`;\n\nexport const StyledHeaderWrapper = styled.div<{ heightOffsetPx?: number }>`\n  display: flex;\n  width: 100%;\n  height: 100%;\n  position: sticky;\n  top: ${({ heightOffsetPx }) =>\n    heightOffsetPx ? `${heightOffsetPx}px` : \"0px\"};\n  z-index: 1;\n`;\n\nexport const StyledColHeader = styled.div<{ width: number; minWidth?: number }>`\n  display: inline-flex;\n  width: ${({ width }) => `${width * 100}%`};\n  min-width: ${({ minWidth }) => (!!minWidth ? `${minWidth}px` : \"none\")};\n  justify-content: center;\n  align-items: center;\n  font-weight: bold;\n  border: 1px solid lightgrey;\n  cursor: pointer;\n  user-select: none;\n  position: relative;\n  background: white;\n  border-bottom: 1px solid black;\n`;\n\nexport const StyledColText = styled.div`\n  font-size: 0.8em;\n  padding: 1em;\n`;\n\nexport const StyledSortIcon = styled.div`\n  position: absolute;\n  bottom: 0;\n  right: 50%;\n  transform: translate(50%);\n`;\n","import config from \"../../../config\";\nimport {\n  StyledColHeader,\n  StyledColText,\n  StyledHeaderWrapper,\n  StyledSortIcon,\n} from \"./style\";\nimport * as React from \"react\";\nimport { SortDirection, TableColumn, TableSortState } from \"./types\";\n\ntype TableHeaderProps<T> = {\n  columns: TableColumn<T>[];\n  sortState: TableSortState<T>;\n  setSortState: React.Dispatch<React.SetStateAction<TableSortState<T>>>;\n};\n\nfunction oppositeSortDirection(sortDirection: SortDirection): SortDirection {\n  return sortDirection === \"ASC\" ? \"DESC\" : \"ASC\";\n}\n\nexport default function TableHeader<T>(\n  props: TableHeaderProps<T>\n): React.ReactElement {\n  const { columns, sortState, setSortState } = props;\n\n  const sortIcon = !sortState\n    ? \"\"\n    : sortState.direction === \"ASC\"\n    ? \"\\u25B2\"\n    : \"\\u25BC\";\n\n  return (\n    <StyledHeaderWrapper heightOffsetPx={config.tabHeightPx}>\n      {columns.map((col) => {\n        const isSortedCol = sortState && sortState.key === col.key;\n        const onClick = () => {\n          setSortState({\n            key: col.key,\n            direction:\n              !isSortedCol || !sortState\n                ? \"ASC\"\n                : oppositeSortDirection(sortState.direction),\n          });\n        };\n\n        return (\n          <StyledColHeader\n            key={col.key.toString()}\n            onClick={onClick}\n            width={col.width}\n            minWidth={col.minWidthPx}\n          >\n            <StyledColText>{col.text}</StyledColText>\n            <StyledSortIcon>{isSortedCol ? sortIcon : \"\"}</StyledSortIcon>\n          </StyledColHeader>\n        );\n      })}\n      <StyledColHeader\n        width={config.tableDeleteCellWidthPercent}\n        minWidth={config.tableDeleteCellMinWidthPx}\n        style={{ cursor: \"unset\" }}\n      />\n    </StyledHeaderWrapper>\n  );\n}\n","import * as React from \"react\";\nimport styled from \"styled-components/macro\";\nimport { CellOption } from \"../types\";\n\nconst StyledSelect = styled.select`\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  background: unset;\n`;\n\nexport type DropDownTableCellProps = {\n  rowId: string;\n  options: CellOption[];\n  setOption?: CellOption;\n  onSelectOption: (id: string, option: CellOption) => void;\n  optionsFilter?: (option: CellOption) => CellOption[];\n};\n\nexport default function DropDownTableCell(\n  props: DropDownTableCellProps\n): React.ReactElement {\n  function handleChange(event: React.ChangeEvent<HTMLSelectElement>) {\n    const newVal = event.target.value;\n\n    const selectedOption = props.options.find((option) => option.id === newVal);\n\n    if (selectedOption !== undefined) {\n      props.onSelectOption(props.rowId, selectedOption);\n    }\n  }\n\n  return (\n    <StyledSelect value={props.setOption?.id} onChange={handleChange}>\n      {props.options.map((option) => (\n        <option key={option.id} value={option.id}>\n          {option.text}\n        </option>\n      ))}\n    </StyledSelect>\n  );\n}\n","import styled from \"styled-components/macro\";\n\nexport const StyledInput = styled.input`\n  display: inline-block;\n  border: none;\n  width: 100%;\n  height: 100%;\n  text-align: center;\n  padding: 0;\n  background: unset;\n\n  &::-webkit-inner-spin-button,\n  &::-webkit-outer-spin-button {\n    -webkit-appearance: none;\n    margin: 0;\n  }\n`;\n\nexport const StyledEditor = styled.div<{ width: number; height: number }>`\n  height: ${(props) => props.height}px;\n  width: ${(props) => props.width}px;\n  border-left: 3px solid black;\n`;\n\nexport const StyledTables = styled.div<{ heightFrac: number }>`\n  display: inline-flex;\n  width: 100%;\n  height: ${(props) => props.heightFrac * 100}%;\n  position: relative;\n`;\n\nexport const StyledModelControlsWrapper = styled.div<{ heightFrac: number }>`\n  display: inline-flex;\n  width: 100%;\n  height: ${(props) => props.heightFrac * 100}%;\n  position: relative;\n`;\n","import React, { useCallback, useRef, useState } from \"react\";\nimport { StyledInput } from \"./style\";\n\ninterface CanBeMadeString {\n  toString: () => string;\n}\n\ntype EditableInputProps<T> = {\n  initialValue: T;\n  onBlur: (value: T) => void;\n  getNewValue: (event: React.ChangeEvent<HTMLInputElement>) => T | undefined;\n  afterValue?: string;\n  validator: (value: string) => T;\n};\n\nexport default function EditableInput<T extends CanBeMadeString>(\n  props: EditableInputProps<T>\n): React.ReactElement {\n  const { initialValue, onBlur, getNewValue, afterValue, validator } = props;\n\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const withAfterValue = useCallback(\n    (val: string) => val + (afterValue || \"\"),\n    [afterValue]\n  );\n\n  const [value, setValue] = useState<string>(\n    withAfterValue(initialValue.toString())\n  );\n\n  function handleOnChange(event: React.ChangeEvent<HTMLInputElement>) {\n    const newVal = event.target.value;\n    if (newVal !== undefined) {\n      setValue(newVal);\n    }\n  }\n\n  const handleOnBlur = useCallback(\n    (event: React.ChangeEvent<HTMLInputElement>) => {\n      const newVal = getNewValue(event);\n      if (event.target.value === initialValue.toString()) {\n        setValue((prevVal) => withAfterValue(prevVal));\n        return;\n      } else if (newVal !== undefined) {\n        const validated = validator(newVal.toString());\n        setValue(withAfterValue(validated.toString()));\n        onBlur(validated);\n      } else {\n        const validated = validator(initialValue.toString());\n        setValue(withAfterValue(validated.toString()));\n        onBlur(validated);\n      }\n    },\n    [getNewValue, initialValue, onBlur, validator, withAfterValue]\n  );\n\n  return (\n    <StyledInput\n      ref={inputRef}\n      type=\"text\"\n      value={value}\n      onChange={handleOnChange}\n      onFocus={() =>\n        setValue((prevVal) => prevVal.replace(afterValue || \"\", \"\"))\n      }\n      onBlur={handleOnBlur}\n      onKeyDown={(event: React.KeyboardEvent) => {\n        if ([\"Escape\", \"Enter\"].includes(event.key)) {\n          inputRef.current && inputRef.current.blur();\n        }\n      }}\n    />\n  );\n}\n","import React from \"react\";\nimport EditableInput from \"./EditableInput\";\n\ntype EditableStringInputProps = {\n  initialValue: string;\n  onBlur: (value: string) => void;\n  validator?: (val: string) => string;\n};\n\nexport default function EditableStringInput(\n  props: EditableStringInputProps\n): React.ReactElement {\n  const validator = (val: string) =>\n    props.validator ? props.validator(val) : val;\n\n  return (\n    <EditableInput<string>\n      key={props.initialValue}\n      initialValue={props.initialValue}\n      onBlur={props.onBlur}\n      getNewValue={(event: React.ChangeEvent<HTMLInputElement>) =>\n        event.target.value\n      }\n      validator={validator}\n    />\n  );\n}\n","import React from \"react\";\nimport EditableStringInput from \"../../EditableStringInput\";\n\nexport type TextTableCellProps = {\n  initialVal: string;\n  onBlur: (newValue: string) => void;\n  validator?: (val: string) => string;\n};\n\nexport default function TextTableCell(\n  props: TextTableCellProps\n): React.ReactElement {\n  return (\n    <EditableStringInput\n      initialValue={props.initialVal}\n      onBlur={props.onBlur}\n      validator={props.validator}\n    />\n  );\n}\n","import React from \"react\";\nimport EditableInput from \"./EditableInput\";\n\nfunction getFloatVal(\n  event: React.ChangeEvent<HTMLInputElement>\n): number | undefined {\n  const newValueText = event.target.value;\n  // things like 123.3abc will still parse as 123.3\n  const newValueFloat = parseFloat(event.target.value);\n  if (newValueText === undefined || isNaN(newValueFloat)) {\n    return undefined;\n  }\n  return newValueFloat;\n}\n\ntype EditableNumberInputProps = {\n  initialValue: number;\n  onBlur: (value: number) => void;\n  afterValue?: string;\n  validator?: (val: string) => string;\n};\n\nexport default function EditableNumberInput(\n  props: EditableNumberInputProps\n): React.ReactElement {\n  const validator = (val: string) =>\n    props.validator\n      ? parseFloat(props.validator(val.toString()))\n      : parseFloat(val);\n\n  return (\n    <EditableInput<number>\n      key={props.initialValue + (props.afterValue || \"\")}\n      initialValue={props.initialValue}\n      onBlur={props.onBlur}\n      getNewValue={getFloatVal}\n      afterValue={props.afterValue}\n      validator={validator}\n    />\n  );\n}\n","import React from \"react\";\nimport EditableNumberInput from \"../../EditableNumberInput\";\n\nexport type NumericalTableCellProps = {\n  initialVal: number;\n  onBlur: (newValue: number) => void;\n  afterValue?: string;\n  validator?: (val: string) => string;\n};\n\nexport default function NumericalTableCell(\n  props: NumericalTableCellProps\n): React.ReactElement {\n  return (\n    <EditableNumberInput\n      initialValue={props.initialVal}\n      onBlur={props.onBlur}\n      afterValue={props.afterValue}\n      validator={props.validator}\n    />\n  );\n}\n","import React, { useState } from \"react\";\nimport styled from \"styled-components/macro\";\n\nconst StyledCheckbox = styled.div`\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n  user-select: none;\n`;\n\nexport type BooleanTableCellProps = {\n  initialIsActive?: boolean;\n  onClick: (isActive: boolean) => void;\n  showWhenActive: string;\n};\n\nexport default function BooleanTableCell(\n  props: BooleanTableCellProps\n): React.ReactElement {\n  const [isActive, setIsActive] = useState<boolean>(\n    props.initialIsActive !== undefined ? props.initialIsActive : false\n  );\n\n  return (\n    <StyledCheckbox\n      tabIndex={0}\n      onKeyUp={(event: React.KeyboardEvent) => {\n        if (event.key === \"Enter\") {\n          setIsActive(!isActive);\n          props.onClick(!isActive);\n        }\n      }}\n      onClick={() => {\n        setIsActive(!isActive);\n        props.onClick(!isActive);\n      }}\n    >\n      &nbsp;{isActive ? props.showWhenActive : \"\"}\n    </StyledCheckbox>\n  );\n}\n","import * as React from \"react\";\nimport DropDownTableCell from \"./cells/DropDownTableCell\";\nimport TextTableCell from \"./cells/TextTableCell\";\nimport NumericalTableCell from \"./cells/NumericalTableCell\";\nimport BooleanTableCell from \"./cells/BooleanTableCell\";\nimport { CellOption, TableColumn } from \"./types\";\n\ntype TableCellType = {\n  id: string;\n};\n\ntype TableCellProps<T extends TableCellType> = {\n  row: T;\n  col: TableColumn<T>;\n  onUpdateRow: (row: T) => void;\n  options?: CellOption[];\n  initiallySetOption?: CellOption;\n  afterValue?: string;\n};\n\nexport default function TableCell<T extends TableCellType>(\n  props: TableCellProps<T>\n): React.ReactElement {\n  const { row, col, onUpdateRow, options, initiallySetOption, afterValue } =\n    props;\n  const initialVal = row[col.key];\n\n  if (!!options && options.length > 0 && col.onSelectOption) {\n    return (\n      <DropDownTableCell\n        key={row.id}\n        rowId={row.id}\n        options={options}\n        setOption={initiallySetOption}\n        onSelectOption={col.onSelectOption}\n      />\n    );\n  } else if (typeof initialVal === \"string\") {\n    return (\n      <TextTableCell\n        initialVal={initialVal}\n        onBlur={(newVal) => onUpdateRow({ ...row, [col.key]: newVal })}\n        validator={(val) => (col.validator ? col.validator(row.id, val) : val)}\n      />\n    );\n  } else if (\n    typeof initialVal === \"number\" &&\n    typeof row[col.key] === \"number\"\n  ) {\n    return (\n      <NumericalTableCell\n        key={initialVal}\n        initialVal={initialVal}\n        onBlur={(newVal) => onUpdateRow({ ...row, [col.key]: newVal })}\n        afterValue={afterValue}\n        validator={(val) => (col.validator ? col.validator(row.id, val) : val)}\n      />\n    );\n  } else if (typeof initialVal === \"boolean\") {\n    return (\n      <BooleanTableCell\n        key={initialVal.toString()}\n        initialIsActive={initialVal}\n        onClick={(newVal) => onUpdateRow({ ...row, [col.key]: newVal })}\n        showWhenActive={\"\"}\n      />\n    );\n  } else {\n    return <></>;\n  }\n}\n","import * as React from \"react\";\nimport { useState } from \"react\";\nimport { TableSortState } from \"../types\";\n\nexport default function useSortableTable<T>(\n  defaultSortState: TableSortState<T>,\n  tieBreakerKey: keyof T,\n  ultraSuperDuperTieBreakerKey: keyof T\n): [\n  TableSortState<T>,\n  React.Dispatch<React.SetStateAction<TableSortState<T>>>,\n  (first: T, second: T) => number\n] {\n  const [sortState, setSortState] =\n    useState<TableSortState<T>>(defaultSortState);\n\n  function sortByState(first: T, second: T): number {\n    if (sortState.direction === \"ASC\") {\n      if (first[sortState.key] > second[sortState.key]) {\n        return 1;\n      } else if (first[sortState.key] === second[sortState.key]) {\n        if (first[tieBreakerKey] > second[tieBreakerKey]) {\n          return 1;\n        } else if (first[tieBreakerKey] === second[tieBreakerKey]) {\n          return first[ultraSuperDuperTieBreakerKey] >\n            second[ultraSuperDuperTieBreakerKey]\n            ? 1\n            : -1;\n        } else {\n          return -1;\n        }\n      } else {\n        return -1;\n      }\n    } else {\n      if (first[sortState.key] > second[sortState.key]) {\n        return -1;\n      } else if (first[sortState.key] === second[sortState.key]) {\n        return first[tieBreakerKey] > second[tieBreakerKey] ? 1 : -1;\n      } else {\n        return 1;\n      }\n    }\n  }\n\n  return [sortState, setSortState, sortByState];\n}\n","import React from \"react\";\nimport config from \"../../../config\";\nimport { StyledDeleteCell } from \"./style\";\n\ntype DeleteCellProps<T> = {\n  row: T;\n  onDeleteRow: (row: T) => void;\n};\n\nexport default function DeleteCell<T>(\n  props: DeleteCellProps<T>\n): React.ReactElement {\n  return (\n    <StyledDeleteCell\n      tabIndex={0}\n      onKeyUp={(event: React.KeyboardEvent) => {\n        if (event.key === \"Enter\") {\n          props.onDeleteRow(props.row);\n        }\n      }}\n      width={config.tableDeleteCellWidthPercent}\n      minWidth={config.tableDeleteCellMinWidthPx}\n      onClick={() => props.onDeleteRow(props.row)}\n    >\n      \n    </StyledDeleteCell>\n  );\n}\n","import {\n  HSConnection,\n  HSConnectionKind,\n  HSNode,\n  makeConnection,\n  makeNode,\n} from \"hotstuff-network\";\nimport config from \"../config\";\nimport { AppConnection, AppNode } from \"../App\";\nimport { Point } from \"./pointUtils\";\nimport {\n  AppConnectionTable,\n  ConnectionTableColumn,\n} from \"../components/Sidebar/EditableTable/ConnectionTable/ConnectionTable\";\nimport { CellOption } from \"../components/Sidebar/EditableTable/types\";\n\nconst ALL_CONNECTION_KINDS: HSConnectionKind[] = [\"cond\", \"conv\", \"rad\"];\nconst DO_NOT_PAIR_KINDS: HSConnectionKind[] = [\"cond\", \"conv\"]; // cannot have both of these at once\n\nexport function getExistingConnections(\n  firstNodeId: string,\n  secondNodeId: string,\n  connections: HSConnection[]\n): HSConnection[] {\n  return connections.filter(\n    (conn) =>\n      (conn.firstNode.id === firstNodeId &&\n        conn.secondNode.id === secondNodeId) ||\n      (conn.firstNode.id === secondNodeId && conn.secondNode.id === firstNodeId)\n  );\n}\n\nexport const makeNewConnection = (\n  firstNode: HSNode,\n  secondNode: HSNode,\n  kind: HSConnectionKind,\n  resistance?: number\n): AppConnection => {\n  const firstNodeFirst = firstNode.name <= secondNode.name;\n  return {\n    ...makeConnection({\n      firstNode: firstNodeFirst ? firstNode : secondNode,\n      secondNode: firstNodeFirst ? secondNode : firstNode,\n      resistanceDegKPerW: resistance || config.defaultResistanceDegKPerW,\n      kind,\n    }),\n    firstNodeId: firstNodeFirst ? firstNode.id : secondNode.id,\n    secondNodeId: firstNodeFirst ? secondNode.id : firstNode.id,\n  };\n};\n\nexport function getNewConnectionKindsPossible(\n  connectionKind: HSConnectionKind,\n  firstNodeId: string,\n  secondNodeId: string,\n  otherConnections: HSConnection[]\n): HSConnectionKind[] {\n  // if there's another connection between the nodes (either direction) with that same kind:\n  // - no option for the same kind of connection\n  // - no option for both conduction and convection at once as this doesn't make sense physically (solid vs. fluid)\n  const existingConnections = getExistingConnections(\n    firstNodeId,\n    secondNodeId,\n    otherConnections\n  );\n  const existingKinds = existingConnections.map((conn) => conn.kind);\n  if (\n    connectionKind === \"rad\" &&\n    DO_NOT_PAIR_KINDS.some((k) => existingKinds.includes(k))\n  ) {\n    return [];\n  } else\n    return ALL_CONNECTION_KINDS.filter((kind) => !existingKinds.includes(kind));\n}\n\nexport function getNewConnection(\n  firstNode: AppNode,\n  secondNode: AppNode,\n  connections: AppConnection[]\n): AppConnection | undefined {\n  const existingConnections = getExistingConnections(\n    firstNode.id,\n    secondNode.id,\n    connections\n  );\n  // if no current connections, make a conductive connection\n  if (existingConnections.length === 0) {\n    return makeNewConnection(firstNode, secondNode, \"cond\");\n  }\n\n  const existingKinds = existingConnections.map((conn) => conn.kind);\n  const remainingKinds = ALL_CONNECTION_KINDS.filter(\n    (kind) => !existingKinds.includes(kind)\n  );\n\n  if (DO_NOT_PAIR_KINDS.every((k) => !existingKinds.includes(k))) {\n    return makeNewConnection(firstNode, secondNode, \"cond\");\n  } else if (\n    DO_NOT_PAIR_KINDS.some((k) => remainingKinds.includes(k)) &&\n    !existingKinds.includes(\"rad\")\n  ) {\n    return makeNewConnection(firstNode, secondNode, \"rad\");\n  }\n}\n\nexport function getNewPossibleConnection(\n  appNodes: AppNode[],\n  appConnections: AppConnection[]\n): AppConnection | undefined {\n  for (const firstNode of appNodes) {\n    for (const secondNode of appNodes) {\n      if (firstNode.id !== secondNode.id) {\n        const newConnection = getNewConnection(\n          firstNode,\n          secondNode,\n          appConnections\n        );\n        if (!!newConnection) {\n          return newConnection;\n        }\n      }\n    }\n  }\n  return undefined;\n}\n\nfunction newNodeName(i: number): string {\n  if (i === 1) {\n    return config.newNodeNamePrefix;\n  }\n  return `${config.newNodeNamePrefix} [${i}]`;\n}\n\nexport function getNewAppNode(appNodes: AppNode[], center: Point): AppNode {\n  const allNodeNames = appNodes.map((node) => node.name);\n  let i = 1;\n  while (allNodeNames.includes(newNodeName(i))) {\n    i += 1;\n  }\n\n  const newNode = makeNode({\n    name: newNodeName(i),\n    temperatureDegC: config.defaultTempDegC,\n    capacitanceJPerDegK: config.defaultCapJPerDegK,\n    powerGenW: config.defaultPowerGenW,\n    isBoundary: false,\n  });\n\n  return {\n    ...newNode,\n    center: center,\n    isActive: false,\n    textDirection: \"D\",\n  };\n}\n\nexport function validateNodeName(name: string, otherNames: string[]): string {\n  const trimName = name.trim();\n  const safeName = trimName === \"\" ? config.defaultNodeName.trim() : trimName;\n  const safeAllNames = otherNames.map((n) => n.trim());\n  if (safeAllNames.includes(safeName)) {\n    let i = 2;\n    const makeNewName = (i: number) => `${safeName} [${i}]`;\n    while (safeAllNames.includes(makeNewName(i))) {\n      i += 1;\n    }\n    return makeNewName(i);\n  } else {\n    return safeName;\n  }\n}\n\nexport function getConnectionAfterValue(\n  col: ConnectionTableColumn,\n  row: AppConnectionTable\n): string | undefined {\n  return col.key !== \"resistanceDegKPerW\"\n    ? undefined\n    : row.kind === \"rad\"\n    ? \" [K\\u2074/W]\"\n    : \" [K/W]\";\n}\n\nfunction filterFirstAndSecondNodeOptions(\n  filterKey: \"firstNodeId\" | \"secondNodeId\",\n  options: CellOption[],\n  selectedConnection: AppConnection,\n  allOtherConnections: AppConnection[]\n) {\n  const filteringFirstNode = filterKey === \"firstNodeId\";\n\n  // the selected connection should not consider its currently selected value or the ability to connect to itself\n  const noSelfConnectionOptions = options.filter(\n    (option) =>\n      option.id !==\n        (filteringFirstNode\n          ? selectedConnection.firstNode.id\n          : selectedConnection.secondNode.id) &&\n      option.id !==\n        (filteringFirstNode\n          ? selectedConnection.secondNode.id\n          : selectedConnection.firstNode.id)\n  );\n\n  // exclude the options that would create duplicate or illegal connections\n  return noSelfConnectionOptions.filter((option) => {\n    return !allOtherConnections.some((otherConnection) => {\n      const isIllegalConnectionKindCombo =\n        (DO_NOT_PAIR_KINDS.includes(selectedConnection.kind) &&\n          DO_NOT_PAIR_KINDS.includes(otherConnection.kind)) ||\n        selectedConnection.kind === otherConnection.kind;\n\n      if (filteringFirstNode) {\n        return (\n          (isIllegalConnectionKindCombo &&\n            option.id === otherConnection.firstNode.id &&\n            selectedConnection.secondNode.id ===\n              otherConnection.secondNode.id) ||\n          (isIllegalConnectionKindCombo &&\n            option.id === otherConnection.secondNode.id &&\n            selectedConnection.secondNode.id === otherConnection.firstNode.id)\n        );\n      } else {\n        return (\n          (isIllegalConnectionKindCombo &&\n            option.id === otherConnection.secondNode.id &&\n            selectedConnection.firstNode.id === otherConnection.firstNode.id) ||\n          (isIllegalConnectionKindCombo &&\n            option.id === otherConnection.firstNode.id &&\n            selectedConnection.firstNode.id === otherConnection.secondNode.id)\n        );\n      }\n    });\n  });\n}\n\nexport function filterConnectionOptions(\n  colKey: string,\n  options: CellOption[],\n  selectedConnection: AppConnection,\n  connections: AppConnection[]\n): CellOption[] {\n  const otherConnections = connections.filter(\n    (conn) => conn.id !== selectedConnection.id\n  );\n\n  if ([\"firstNodeId\", \"secondNodeId\"].includes(colKey)) {\n    return filterFirstAndSecondNodeOptions(\n      colKey as \"firstNodeId\" | \"secondNodeId\",\n      options,\n      selectedConnection,\n      otherConnections\n    );\n  } else if (colKey === \"kind\") {\n    if (!!selectedConnection) {\n      const possibleKinds = getNewConnectionKindsPossible(\n        selectedConnection.kind,\n        selectedConnection.firstNode.id,\n        selectedConnection.secondNode.id,\n        connections\n      );\n      return options.filter((opt) =>\n        possibleKinds.includes(opt.id as HSConnectionKind)\n      );\n    } else {\n      return options;\n    }\n  } else {\n    return options;\n  }\n}\n","import React, { useMemo } from \"react\";\nimport config from \"../../../../config\";\nimport { AppNode } from \"../../../../App\";\nimport {\n  StyledAddButton,\n  StyledCell,\n  StyledRow,\n  StyledTable,\n  StyledTableBody,\n  StyledTableWrapper,\n} from \"../style\";\nimport { TableColumn, TableSortState } from \"../types\";\nimport TableHeader from \"../TableHeader\";\nimport TableCell from \"../TableCell\";\nimport useSortableTable from \"../hooks/useSortableTable\";\nimport DeleteCell from \"../DeleteCell\";\nimport { validateNodeName } from \"../../../../utils/nodeConnectionUtils\";\nimport { KELVIN } from \"hotstuff-network\";\n\ntype NodeTableColumn = TableColumn<AppNode>;\n\nconst defaultNodeSortState: TableSortState<AppNode> = {\n  key: \"name\",\n  direction: \"ASC\",\n};\n\ntype NodeTableProps = {\n  rows: AppNode[];\n  onUpdateRow: (row: AppNode) => void;\n  onDeleteRow: (row: AppNode) => void;\n  onAddButton: () => void;\n  setTemporaryErrors: (error: string[]) => void;\n};\n\nexport default function NodeTable(props: NodeTableProps): React.ReactElement {\n  const { rows, onUpdateRow, onDeleteRow, onAddButton, setTemporaryErrors } =\n    props;\n\n  const [sortState, setSortState, sortByState] = useSortableTable<AppNode>(\n    defaultNodeSortState,\n    \"temperatureDegC\",\n    \"capacitanceJPerDegK\"\n  );\n\n  const nodeColumns: NodeTableColumn[] = useMemo(\n    () => [\n      {\n        key: \"name\",\n        text: \"Name\",\n        width: 0.3,\n        minWidthPx: 100,\n        validator: (rowId: string, name: string) =>\n          validateNodeName(\n            name,\n            rows.filter((r) => r.id !== rowId).map((r) => r.name)\n          ),\n      },\n      {\n        key: \"temperatureDegC\",\n        text: \"Temp [C]\",\n        width: 0.15,\n        minWidthPx: 100,\n        validator: (rowId, tempVal) => {\n          if (parseFloat(tempVal) < -KELVIN) {\n            setTemporaryErrors([\n              \"Temperature colder than what is physically possible\",\n            ]);\n            return (-KELVIN).toString();\n          }\n          return tempVal;\n        },\n      },\n      {\n        key: \"capacitanceJPerDegK\",\n        text: \"Capacitance [J/K]\",\n        width: 0.15,\n        minWidthPx: 100,\n      },\n      {\n        key: \"powerGenW\",\n        text: \"Power Gen [W]\",\n        width: 0.15,\n        minWidthPx: 80,\n      },\n      {\n        key: \"isBoundary\",\n        text: \"Fixed Temp?\",\n        width: 0.15,\n        minWidthPx: 80,\n      },\n    ],\n    [rows, setTemporaryErrors]\n  );\n\n  const sortedRows = rows.sort(sortByState);\n\n  const tableRows = sortedRows.map((row) => {\n    return (\n      <StyledRow\n        key={row.id}\n        heightOffsetPx={config.tabHeightPx}\n        isActive={row.isActive}\n      >\n        {nodeColumns.map((col) => {\n          const tableCell = (\n            <TableCell<AppNode> row={row} col={col} onUpdateRow={onUpdateRow} />\n          );\n          return (\n            <StyledCell\n              key={col.key}\n              width={col.width}\n              minWidth={col.minWidthPx}\n            >\n              {tableCell}\n            </StyledCell>\n          );\n        })}\n        <DeleteCell row={row} onDeleteRow={() => onDeleteRow(row)} />\n      </StyledRow>\n    );\n  });\n\n  return (\n    <StyledTableWrapper>\n      <StyledTable>\n        <TableHeader<AppNode>\n          columns={nodeColumns}\n          sortState={sortState}\n          setSortState={setSortState}\n        />\n        <StyledTableBody>{tableRows}</StyledTableBody>\n        <StyledAddButton onClick={onAddButton}>+</StyledAddButton>\n      </StyledTable>\n    </StyledTableWrapper>\n  );\n}\n","import React, { useCallback, useMemo } from \"react\";\nimport config from \"../../../../config\";\nimport { AppConnection, AppNode } from \"../../../../App\";\nimport {\n  StyledAddButton,\n  StyledCell,\n  StyledRow,\n  StyledTable,\n  StyledTableBody,\n  StyledTableWrapper,\n} from \"../style\";\nimport { CellOption, TableColumn, TableSortState } from \"../types\";\nimport TableHeader from \"../TableHeader\";\nimport TableCell from \"../TableCell\";\nimport useSortableTable from \"../hooks/useSortableTable\";\nimport DeleteCell from \"../DeleteCell\";\nimport { HSConnectionKind } from \"hotstuff-network\";\nimport {\n  filterConnectionOptions,\n  getConnectionAfterValue,\n} from \"../../../../utils/nodeConnectionUtils\";\n\nexport type AppConnectionTable = AppConnection & { isActive: boolean };\nexport type ConnectionTableColumn = TableColumn<AppConnectionTable>;\n\nconst defaultConnectionSortState: TableSortState<AppConnectionTable> = {\n  key: \"firstNodeId\",\n  direction: \"ASC\",\n};\n\nconst connectionTypes: CellOption[] = [\n  {\n    id: \"cond\",\n    text: \" Conduction\",\n  },\n  {\n    id: \"conv\",\n    text: \" Convection\",\n  },\n  {\n    id: \"rad\",\n    text: \" Radiation\",\n  },\n];\n\ntype ConnectionTableProps = {\n  rows: AppConnection[];\n  nodes: AppNode[];\n  onUpdateRow: (row: AppConnection) => void;\n  onDeleteRow: (row: AppConnection) => void;\n  onAddButton: () => void;\n  setTemporaryErrors: (error: string[]) => void;\n};\n\nexport default function ConnectionTable(\n  props: ConnectionTableProps\n): React.ReactElement {\n  const {\n    rows,\n    nodes,\n    onUpdateRow,\n    onDeleteRow,\n    onAddButton,\n    setTemporaryErrors,\n  } = props;\n\n  const [sortState, setSortState, sortByState] =\n    useSortableTable<AppConnectionTable>(\n      defaultConnectionSortState,\n      \"secondNodeId\",\n      \"kind\"\n    );\n\n  const onSelectNewfirstNode = useCallback(\n    (id: string, option: CellOption) => {\n      const connection = rows.find((conn) => conn.id === id);\n      const newfirstNodeNode = nodes.find((node) => node.id === option.id);\n      if (\n        !connection ||\n        !newfirstNodeNode ||\n        newfirstNodeNode.id === connection.secondNode.id\n      ) {\n        return;\n      }\n      onUpdateRow({\n        ...connection,\n        firstNode: newfirstNodeNode,\n        firstNodeId: newfirstNodeNode.id,\n      });\n    },\n    [nodes, onUpdateRow, rows]\n  );\n\n  const onSelectNewsecondNode = useCallback(\n    (id: string, option: CellOption) => {\n      const connection = rows.find((conn) => conn.id === id);\n      const newsecondNodeNode = nodes.find((node) => node.id === option.id);\n      if (\n        !connection ||\n        !newsecondNodeNode ||\n        newsecondNodeNode.id === connection.firstNode.id\n      ) {\n        return;\n      }\n      onUpdateRow({\n        ...connection,\n        secondNode: newsecondNodeNode,\n        secondNodeId: newsecondNodeNode.id,\n      });\n    },\n    [nodes, onUpdateRow, rows]\n  );\n\n  const onSelectNewConnectionType = useCallback(\n    (id: string, option: CellOption) => {\n      const rowToUpdate = rows.find((conn) => conn.id === id);\n      if (rowToUpdate) {\n        onUpdateRow({\n          ...rowToUpdate,\n          kind: option.id as HSConnectionKind,\n        });\n      }\n    },\n    [onUpdateRow, rows]\n  );\n\n  const nodeOptions: CellOption[] = nodes.map((node) => ({\n    id: node.id,\n    text: node.name,\n  }));\n\n  const connectionColumns: ConnectionTableColumn[] = useMemo(\n    () => [\n      {\n        text: \"First Node\",\n        key: \"firstNodeId\",\n        width: 0.3,\n        minWidthPx: 100,\n        options: nodeOptions,\n        onSelectOption: onSelectNewfirstNode,\n      },\n      {\n        text: \"Second Node\",\n        key: \"secondNodeId\",\n        width: 0.3,\n        minWidthPx: 100,\n        options: nodeOptions,\n        onSelectOption: onSelectNewsecondNode,\n      },\n      {\n        text: \"Resistance\",\n        key: \"resistanceDegKPerW\",\n        width: 0.2,\n        minWidthPx: 100,\n        validator: (rowId, resistance) => {\n          const resistanceNumber = parseFloat(resistance);\n          if (resistanceNumber <= 0) {\n            if (resistanceNumber === 0) {\n              setTemporaryErrors([\"Resistance cannot be zero\"]);\n            } else {\n              setTemporaryErrors([\"Resistance cannot be negative\"]);\n            }\n            return config.defaultSmallResistanceDegKPerW.toString();\n          }\n          return resistance;\n        },\n      },\n      {\n        text: \"Kind\",\n        key: \"kind\",\n        width: 0.2,\n        minWidthPx: 100,\n        options: connectionTypes,\n        onSelectOption: onSelectNewConnectionType,\n      },\n    ],\n    [\n      nodeOptions,\n      onSelectNewConnectionType,\n      onSelectNewfirstNode,\n      onSelectNewsecondNode,\n      setTemporaryErrors,\n    ]\n  );\n\n  const activeNodeIds = nodes\n    .filter((node) => node.isActive)\n    .map((node) => node.id);\n\n  const sortedRowsWithActiveInfo: AppConnectionTable[] = rows\n    .map((row) => {\n      return {\n        ...row,\n        isActive:\n          activeNodeIds.includes(row.firstNode.id) ||\n          activeNodeIds.includes(row.secondNode.id),\n      };\n    })\n    .sort(sortByState);\n\n  const tableRows = sortedRowsWithActiveInfo.map((row) => {\n    const cols = connectionColumns.map((col) => {\n      function makeStyledCell(\n        options: CellOption[],\n        setOption: CellOption | undefined\n      ) {\n        return (\n          <StyledCell key={col.key} width={col.width} minWidth={col.minWidthPx}>\n            <TableCell<AppConnectionTable>\n              row={row}\n              col={col}\n              options={options}\n              initiallySetOption={setOption}\n              onUpdateRow={onUpdateRow}\n              afterValue={getConnectionAfterValue(col, row)}\n            />\n          </StyledCell>\n        );\n      }\n\n      if (!!col.options) {\n        const setOption = col.options.find(\n          (option) => option.id === row[col.key]\n        );\n\n        const options = !setOption\n          ? []\n          : [\n              setOption,\n              ...filterConnectionOptions(\n                col.key,\n                col.options || [],\n                row,\n                rows\n              ).filter((opt) => opt.id !== setOption.id),\n            ];\n\n        return makeStyledCell(options, setOption);\n      } else {\n        return makeStyledCell([], undefined);\n      }\n    });\n\n    return (\n      <StyledRow\n        key={row.id}\n        heightOffsetPx={config.tabHeightPx}\n        isActive={row.isActive}\n      >\n        {cols}\n        <DeleteCell row={row} onDeleteRow={() => onDeleteRow(row)} />\n      </StyledRow>\n    );\n  });\n\n  return (\n    <StyledTableWrapper>\n      <StyledTable>\n        <TableHeader<AppConnectionTable>\n          columns={connectionColumns}\n          sortState={sortState}\n          setSortState={setSortState}\n        />\n        <StyledTableBody>{tableRows}</StyledTableBody>\n        <StyledAddButton onClick={onAddButton}>+</StyledAddButton>\n      </StyledTable>\n    </StyledTableWrapper>\n  );\n}\n","import React, { useState } from \"react\";\nimport styled from \"styled-components/macro\";\nimport config from \"../../config\";\n\nconst StyledTabsWrapper = styled.div`\n  display: inline-flex;\n  width: 100%;\n  flex-direction: column;\n  overflow: auto;\n  position: relative;\n`;\n\nconst StyledTabs = styled.div`\n  display: inline-flex;\n  width: 100%;\n  height: ${config.tabHeightPx}px;\n  justify-content: space-evenly;\n  position: sticky;\n  top: 0;\n  background: white;\n  box-sizing: border-box;\n  z-index: 1;\n`;\n\nconst StyledTab = styled.div<{ width: number }>`\n  display: inline-flex;\n  width: ${({ width }) => `${width * 100}%`};\n  cursor: pointer;\n  text-decoration: none;\n  align-items: center;\n  //background: lightgray;\n  //background: rgb(85, 9, 121);\n  background: linear-gradient(\n    90deg,\n    rgba(46, 228, 233, 1) 0%,\n    rgba(46, 228, 233, 1) 40%,\n    rgba(255, 0, 230, 1) 80%,\n    rgba(85, 9, 121, 1) 100%\n  );\n  border-radius: 5px 5px 0 0;\n  border: 1px solid black;\n  border-bottom: 2px solid black;\n\n  &:hover,\n  &:focus {\n    opacity: 0.7;\n  }\n`;\n\nconst StyledTabText = styled.div`\n  font-size: 1.1em;\n  padding: 0.2em 0.5em;\n\n  &.active {\n    font-weight: bold;\n  }\n`;\n\nconst StyledInnerContent = styled.div<{ topLeftRounded: boolean }>`\n  background: white;\n  position: relative;\n`;\n\ntype Tab = {\n  text: string;\n  component: React.ReactElement;\n  width: number; // between 0 and 1\n};\n\nexport type TabsProps = {\n  tabs: Tab[];\n};\n\nexport default function Tabs(props: TabsProps): React.ReactElement {\n  const [activeIdx, setActiveIdx] = useState(0);\n\n  return (\n    <StyledTabsWrapper>\n      {props.tabs.length > 1 && (\n        <StyledTabs>\n          {props.tabs.map((tab, idx) => {\n            return (\n              <StyledTab\n                key={tab.text}\n                tabIndex={0}\n                onClick={() => setActiveIdx(idx)}\n                onKeyUp={(event: React.KeyboardEvent) => {\n                  if (event.key === \"Enter\") {\n                    setActiveIdx(idx);\n                  }\n                }}\n                width={tab.width}\n              >\n                <StyledTabText className={idx === activeIdx ? \"active\" : \"\"}>\n                  {tab.text}\n                </StyledTabText>\n              </StyledTab>\n            );\n          })}\n        </StyledTabs>\n      )}\n\n      <StyledInnerContent topLeftRounded={props.tabs.length <= 1}>\n        {props.tabs.filter((_, idx) => idx === activeIdx)[0].component}\n      </StyledInnerContent>\n    </StyledTabsWrapper>\n  );\n}\n","export type Point = {\n  x: number;\n  y: number;\n};\n\nexport const ORIGIN = Object.freeze({ x: 0, y: 0 });\n\nexport function makePoint(x: number, y: number): Point {\n  return { x, y };\n}\n\nexport function addPoints(p1: Point, p2: Point): Point {\n  return { x: p1.x + p2.x, y: p1.y + p2.y };\n}\n\nexport function diffPoints(p1: Point, p2: Point): Point {\n  return { x: p1.x - p2.x, y: p1.y - p2.y };\n}\n\nexport function scalePoint(p1: Point, scale: number): Point {\n  return { x: p1.x / scale, y: p1.y / scale };\n}\n\n// export function distanceBetweenPoints(p1: Point, p2: Point): number {\n//   return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n// }\n","import { makeNode } from \"hotstuff-network\";\nimport {\n  AppConnection,\n  AppNode,\n  AppState,\n  ModalState,\n  PanelSizes,\n  Timing,\n} from \"./App\";\nimport config from \"./config\";\nimport { ORIGIN } from \"./utils/pointUtils\";\nimport { CanvasViewState } from \"./components/Canvas/Canvas\";\nimport { makeNewConnection } from \"./utils/nodeConnectionUtils\";\n\nconst jerryNode = makeNode({\n  name: \"Jerry the Cat\",\n  temperatureDegC: 38.3,\n  capacitanceJPerDegK: 16.2e3, // 3.6kJ/kg/degK * 4.5kg\n  powerGenW: 100, // ??\n  isBoundary: false,\n});\nconst jerryAppNode: AppNode = {\n  ...jerryNode,\n  center: { x: 200, y: 150 },\n  isActive: false,\n  textDirection: \"L\",\n};\n\nconst bedNode = makeNode({\n  name: \"Heated Cat Bed\",\n  temperatureDegC: 40, // ??\n  capacitanceJPerDegK: 10e3,\n  powerGenW: 4,\n  isBoundary: false,\n});\nconst bedAppNode: AppNode = {\n  ...bedNode,\n  center: { x: 500, y: 150 },\n  isActive: false,\n  textDirection: \"R\",\n};\n\nconst airNode = makeNode({\n  name: \"Apartment Air\",\n  temperatureDegC: 22.5,\n  capacitanceJPerDegK: 6e5, // 1.0035J/g/degK * 600,000g\n  powerGenW: 0,\n  isBoundary: false,\n});\nconst airAppNode: AppNode = {\n  ...airNode,\n  center: { x: 350, y: 300 },\n  isActive: false,\n  textDirection: \"D\",\n};\n\nexport const defaultNodes: AppNode[] = [jerryAppNode, bedAppNode, airAppNode];\n\nexport const defaultConnections: AppConnection[] = [\n  makeNewConnection(jerryNode, bedNode, \"cond\", 2.5), // 0.01m / 0.1m^2 / 0.04W/m/degK\n  makeNewConnection(airNode, jerryNode, \"conv\", 0.33), // 1 / 0.3m^2 / 10W/m^2/degK\n  makeNewConnection(airNode, bedNode, \"conv\", 0.67), // 1 / 0.3m^2 / 5W/m^2/degK\n];\n\nexport const defaultTiming: Timing = {\n  timeStepS: config.defaultTimeStepSeconds,\n  totalTimeS: config.defaultTotalTimeSeconds,\n};\n\nexport const defaultCanvasViewState: CanvasViewState = {\n  offset: ORIGIN,\n  scale: 1,\n};\n\nexport const defaultPanelSizes: PanelSizes = {\n  editorWidthFraction: config.defaultEditorWidthFraction,\n  canvasHeightFraction: config.defaultCanvasHeightFraction,\n  tableHeightFraction: config.defaultTableHeightFraction,\n};\n\nexport const defaultModalState: ModalState = {\n  visible: false,\n  type: \"theory\",\n};\n\nexport const defaultAppState: AppState = {\n  timing: defaultTiming,\n  nodes: defaultNodes,\n  connections: defaultConnections,\n  canvasViewState: defaultCanvasViewState,\n  savedCanvasState: defaultCanvasViewState,\n  panelSizes: defaultPanelSizes,\n};\n","import * as React from \"react\";\nimport { useRef, useState } from \"react\";\nimport styled from \"styled-components/macro\";\nimport EditableNumberInput from \"./EditableNumberInput\";\nimport { AppState, ModalState, Timing } from \"../../App\";\nimport { defaultAppState } from \"../../default\";\nimport { ModelOutput } from \"hotstuff-network\";\n\nconst StyledModelControlsWrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  justify-content: center;\n  align-items: center;\n  border-top: 3px solid black;\n  flex-wrap: wrap;\n`;\n\nconst StyledButton = styled.button`\n  margin-top: 5px;\n  margin-bottom: 5px;\n`;\n\nconst StyledAnchor = styled.a`\n  margin-top: 5px;\n  margin-bottom: 5px;\n`;\n\nconst StyledImport = styled.div`\n  padding: 0.2em;\n  border: 1px solid black;\n`;\n\nconst StyledInput = styled.input`\n  margin-right: 0.5em;\n`;\n\nconst StyledTopControls = styled.div`\n  display: flex;\n  > * {\n    margin: 1em;\n  }\n`;\n\nconst StyledTimeControls = styled.div``;\n\nconst StyledTimeControl = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  width: 100%;\n  align-items: center;\n  justify-content: space-between;\n  margin: 0.5em;\n`;\n\nconst StyledInputWrapper = styled.div`\n  border: 1px solid black;\n  border-radius: 2px;\n  max-width: 3em;\n  height: 1.5em;\n`;\n\nconst StyledLabel = styled.label`\n  margin-right: 0.2em;\n`;\n\nexport type ModelControlsProps = {\n  appState: AppState;\n  setAppState: React.Dispatch<React.SetStateAction<AppState>>;\n  setOutput: React.Dispatch<React.SetStateAction<ModelOutput | undefined>>;\n  setModalState: React.Dispatch<React.SetStateAction<ModalState>>;\n  onRunModel: () => ModelOutput | undefined;\n  setTiming: (newTiming: Timing) => void;\n};\n\nexport default function ModelControls(\n  props: ModelControlsProps\n): React.ReactElement {\n  const {\n    appState,\n    setAppState,\n    setOutput,\n    setModalState,\n    onRunModel,\n    setTiming,\n  } = props;\n\n  const [stagedAppState, setStagedAppState] = useState<string>(\"\");\n  const downloadModelRef = useRef<HTMLAnchorElement>(null);\n\n  return (\n    <StyledModelControlsWrapper>\n      <StyledTimeControls>\n        <StyledTimeControl>\n          <StyledLabel>Run Time [s]:</StyledLabel>\n          <StyledInputWrapper>\n            <EditableNumberInput\n              initialValue={appState.timing.totalTimeS}\n              onBlur={(newTotalTimeS: number) =>\n                setTiming({ ...appState.timing, totalTimeS: newTotalTimeS })\n              }\n            />\n          </StyledInputWrapper>\n        </StyledTimeControl>\n        <StyledTimeControl>\n          <StyledLabel>Time Step [s]:</StyledLabel>\n          <StyledInputWrapper>\n            <EditableNumberInput\n              initialValue={appState.timing.timeStepS}\n              onBlur={(newTimeStepS: number) =>\n                setTiming({\n                  ...appState.timing,\n                  timeStepS: newTimeStepS,\n                })\n              }\n            />\n          </StyledInputWrapper>\n        </StyledTimeControl>\n      </StyledTimeControls>\n      <StyledTopControls>\n        <StyledButton onClick={onRunModel}>Run Model</StyledButton>\n        <StyledButton\n          onClick={() =>\n            navigator.clipboard.writeText(JSON.stringify(appState))\n          }\n        >\n          Copy Model\n        </StyledButton>\n        <StyledButton\n          onClick={() => {\n            const newOutput = onRunModel();\n            navigator.clipboard.writeText(\n              JSON.stringify({ ...appState, newOutput })\n            );\n          }}\n        >\n          Run & Copy Results\n        </StyledButton>\n        <StyledAnchor\n          ref={downloadModelRef}\n          onClick={() => {\n            if (downloadModelRef.current) {\n              const blob = new Blob([JSON.stringify(appState)], {\n                type: \"text/plain;charset=utf-8\",\n              });\n              const url = URL.createObjectURL(blob);\n              downloadModelRef.current.setAttribute(\"href\", url);\n\n              const now = new Date();\n              downloadModelRef.current.setAttribute(\n                \"download\",\n                `${now.getFullYear()}-${\n                  now.getMonth() + 1\n                }-${now.getDate()}T${now.getHours()}-${now.getMinutes()}-${now.getSeconds()}_thermal_model.json`\n              );\n            }\n          }}\n        >\n          Download Model\n        </StyledAnchor>\n      </StyledTopControls>\n      <StyledImport>\n        <StyledLabel>Model:</StyledLabel>\n        <StyledInput\n          value={stagedAppState}\n          onChange={(event) => setStagedAppState(event.target.value)}\n        />\n        <StyledButton\n          onClick={() => {\n            setAppState(JSON.parse(stagedAppState));\n            setStagedAppState(\"\");\n          }}\n        >\n          Import\n        </StyledButton>\n      </StyledImport>\n\n      <StyledButton\n        onClick={() =>\n          setModalState((prev) => ({\n            ...prev,\n            visible: true,\n            type: \"confirm\",\n            onConfirm: () => {\n              setAppState(defaultAppState);\n              setOutput(undefined);\n            },\n            confirmText: [\n              \"This will reset the entire model, discarding all your current nodes, connections, parameters and results.\",\n              \"Permanently reset everything?\",\n            ],\n          }))\n        }\n      >\n        Reset\n      </StyledButton>\n    </StyledModelControlsWrapper>\n  );\n}\n","import * as React from \"react\";\nimport config from \"../../../config\";\nimport { useState } from \"react\";\n\nexport default function useTemporaryError(): [\n  string[],\n  React.Dispatch<React.SetStateAction<string[]>>,\n  (errors: string[]) => void\n] {\n  const [errors, setErrors] = useState<string[]>([]);\n\n  const setTemporaryErrors = (errors: string[]) => {\n    setErrors(errors);\n    setTimeout(() => setErrors([]), config.errorMessageDurationSeconds * 1000);\n  };\n\n  return [errors, setErrors, setTemporaryErrors];\n}\n","import styled from \"styled-components/macro\";\n\nexport const StyledExitButton = styled.button`\n  position: absolute;\n  right: 1em;\n  top: 1em;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 30px;\n  height: 30px;\n  margin: 0;\n  padding: 0;\n`;\n","import * as React from \"react\";\nimport styled from \"styled-components/macro\";\nimport config from \"../../config\";\nimport { StyledExitButton } from \"./style\";\n\nexport const StyledError = styled.div<{ isVisible: boolean }>`\n  color: red;\n  background: white;\n  font-size: 2em;\n  text-align: center;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translateX(-50%) translateY(-50%);\n  padding: 2em;\n  z-index: 20;\n  width: 80%;\n  border: 1px solid red;\n  opacity: 0.9;\n  animation: FadeAnimation ${config.errorMessageDurationSeconds}s ease-in\n    forwards;\n\n  @keyframes FadeAnimation {\n    0% {\n      opacity: 0.9;\n      visibility: ${({ isVisible }) => (isVisible ? \"visible\" : \"hidden\")};\n    }\n    80% {\n      opacity: 0.9;\n      visibility: ${({ isVisible }) => (isVisible ? \"visible\" : \"hidden\")};\n    }\n    100% {\n      opacity: 0;\n      visibility: hidden;\n    }\n  }\n`;\n\ntype ErrorModalProps = {\n  errors: string[];\n  setErrors: React.Dispatch<React.SetStateAction<string[]>>;\n};\n\nexport default function ErrorModal(props: ErrorModalProps): React.ReactElement {\n  const { errors, setErrors } = props;\n\n  if (errors.length === 0) {\n    return <></>;\n  }\n\n  return (\n    <StyledError isVisible={true}>\n      <StyledExitButton\n        onClick={() => {\n          setErrors([]);\n        }}\n      >\n        \n      </StyledExitButton>\n      {errors.map((err) => (\n        <div key={err}>{err}</div>\n      ))}\n    </StyledError>\n  );\n}\n","import * as React from \"react\";\nimport {\n  AppConnection,\n  AppNode,\n  AppState,\n  ModalState,\n  Timing,\n} from \"../../App\";\nimport NodeTable from \"./EditableTable/NodeTable/NodeTable\";\nimport ConnectionTable from \"./EditableTable/ConnectionTable/ConnectionTable\";\nimport Tabs from \"../Tabs/Tabs\";\nimport ModelControls from \"./ModelControls\";\nimport {\n  StyledEditor,\n  StyledModelControlsWrapper,\n  StyledTables,\n} from \"./style\";\nimport { ModelOutput } from \"hotstuff-network\";\nimport useTemporaryError from \"./hooks/useTemporaryError\";\nimport config from \"../../config\";\nimport ErrorModal from \"../Modal/ErrorModal\";\n\ntype SidebarProps = {\n  appState: AppState;\n  setAppState: React.Dispatch<React.SetStateAction<AppState>>;\n  setOutput: React.Dispatch<React.SetStateAction<ModelOutput | undefined>>;\n  setModalState: React.Dispatch<React.SetStateAction<ModalState>>;\n  width: number;\n  height: number;\n  setTiming: (newTiming: Timing) => void;\n  onAddNode: () => void;\n  onAddConnection: () => void;\n  updateNodes: (nodes: AppNode[], clearActiveNodes: boolean) => void;\n  deleteNodes: (nodeIds: string[]) => void;\n  updateConnections: (connections: AppConnection[]) => void;\n  deleteConnections: (connectionIds: string[]) => void;\n  onRunModel: () => ModelOutput | undefined;\n};\n\nexport default function Sidebar(props: SidebarProps): React.ReactElement {\n  const {\n    appState,\n    setAppState,\n    setOutput,\n    setModalState,\n    width,\n    height,\n    setTiming,\n    onAddNode,\n    onAddConnection,\n    updateNodes,\n    deleteNodes,\n    updateConnections,\n    deleteConnections,\n    onRunModel,\n  } = props;\n\n  const [tableErrors, setTableErrors, setTemporaryTableErrors] =\n    useTemporaryError();\n  const [\n    modelControlsErrors,\n    setModelControlsErrors,\n    setTemporaryModelControlsErrors,\n  ] = useTemporaryError();\n\n  const nodeTable = (\n    <NodeTable\n      rows={appState.nodes}\n      onUpdateRow={(node: AppNode) => updateNodes([node], false)}\n      onDeleteRow={(node: AppNode) => deleteNodes([node.id])}\n      onAddButton={onAddNode}\n      setTemporaryErrors={setTemporaryTableErrors}\n    />\n  );\n\n  const connectionTable = (\n    <ConnectionTable\n      rows={appState.connections}\n      nodes={appState.nodes}\n      onUpdateRow={(connection: AppConnection) =>\n        updateConnections([connection])\n      }\n      onDeleteRow={(connection: AppConnection) =>\n        deleteConnections([connection.id])\n      }\n      onAddButton={onAddConnection}\n      setTemporaryErrors={setTemporaryTableErrors}\n    />\n  );\n\n  return (\n    <StyledEditor width={width} height={height}>\n      <StyledTables heightFrac={appState.panelSizes.tableHeightFraction}>\n        <ErrorModal errors={tableErrors} setErrors={setTableErrors} />\n        <Tabs\n          tabs={[\n            { text: \"Nodes\", component: nodeTable, width: 0.5 },\n            { text: \"Connections\", component: connectionTable, width: 0.5 },\n          ]}\n        />\n      </StyledTables>\n      <StyledModelControlsWrapper\n        heightFrac={1 - appState.panelSizes.tableHeightFraction}\n      >\n        <ErrorModal\n          errors={modelControlsErrors}\n          setErrors={setModelControlsErrors}\n        />\n        <ModelControls\n          appState={appState}\n          setAppState={setAppState}\n          setOutput={setOutput}\n          setModalState={setModalState}\n          onRunModel={() => {\n            if (\n              Math.ceil(\n                appState.timing.totalTimeS / appState.timing.timeStepS\n              ) > config.maxTimeSteps\n            ) {\n              setTemporaryModelControlsErrors([\n                `Decrease model run time or increase time step size`,\n              ]);\n              return;\n            }\n            return onRunModel();\n          }}\n          setTiming={setTiming}\n        />\n      </StyledModelControlsWrapper>\n    </StyledEditor>\n  );\n}\n","import {\n  CartesianGrid,\n  Legend,\n  LineChart,\n  Tooltip,\n  TooltipPayload,\n  TooltipProps,\n  XAxis,\n  YAxis,\n} from \"recharts\";\nimport * as React from \"react\";\nimport { PlotDimensions } from \"./Plot\";\nimport styled from \"styled-components/macro\";\n\nconst StyledToolTip = styled.div`\n  background: rgba(255, 255, 255, 0.7);\n  padding: 0.2em;\n  //border-radius: 10px;\n  border: 1px solid black;\n`;\n\nconst StyledToolTipTitle = styled.div`\n  font-size: 1em;\n  font-weight: bold;\n`;\n\nconst StyledToolTipItem = styled.div<{ color: string }>`\n  color: ${(props) => props.color};\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst StyledToolTipValue = styled.div<{ after: string }>`\n  margin-left: 1em;\n\n  &::after {\n    content: \"${(props) => props.after}\";\n  }\n`;\n\nfunction CustomTooltip(props: TooltipProps & { after: string }) {\n  const { active, payload, label, after } = props;\n\n  if (active && payload && payload.length) {\n    const sortedPayload = [...payload].sort(\n      (a: TooltipPayload, b: TooltipPayload) => {\n        if (a.value > b.value) {\n          return -1;\n        } else if (a.value === b.value) {\n          if (a.name > b.name) {\n            return 1;\n          } else {\n            return -1;\n          }\n        } else {\n          return 1;\n        }\n      }\n    );\n\n    return (\n      <StyledToolTip>\n        <StyledToolTipTitle>{`Time: ${label}s`}</StyledToolTipTitle>\n        {sortedPayload.map((item) => {\n          return (\n            <StyledToolTipItem key={item.name} color={item.color || \"black\"}>\n              <div>{item.name}</div>\n              <StyledToolTipValue after={after}>\n                {item.value}\n              </StyledToolTipValue>\n            </StyledToolTipItem>\n          );\n        })}\n      </StyledToolTip>\n    );\n  }\n\n  return null;\n}\n\ntype LinePlotProps = {\n  plotDimensions: PlotDimensions;\n  plotData?: ReadonlyArray<Record<string, unknown>>;\n  lines: React.ReactElement[];\n  xAxisKey: string;\n  xLabel: string;\n  yLabel: string;\n  yDomain?: [number, number];\n  unit: string;\n};\n\nexport default function LinePlot(props: LinePlotProps): React.ReactElement {\n  const {\n    plotDimensions,\n    plotData,\n    lines,\n    xAxisKey,\n    xLabel,\n    yLabel,\n    yDomain,\n    unit,\n  } = props;\n\n  return (\n    <LineChart\n      height={plotDimensions.height}\n      width={plotDimensions.width}\n      margin={plotDimensions.margin}\n      data={plotData}\n    >\n      <CartesianGrid strokeDasharray=\"3 3\" />\n      <XAxis\n        dataKey={xAxisKey}\n        label={{\n          value: xLabel,\n          position: \"center\",\n          dy: 20,\n        }}\n      />\n      <YAxis\n        domain={yDomain}\n        label={{\n          value: yLabel,\n          position: \"center\",\n          angle: -90,\n          dx: -20,\n        }}\n      />\n      <Tooltip content={<CustomTooltip after={unit} />} />\n      <Legend\n        layout=\"horizontal\"\n        verticalAlign=\"top\"\n        align=\"center\"\n        wrapperStyle={{\n          paddingLeft: \"10px\",\n          paddingBottom: \"10px\",\n        }}\n      />\n      {lines}\n    </LineChart>\n  );\n}\n","import * as React from \"react\";\nimport { useMemo } from \"react\";\nimport { Line } from \"recharts\";\nimport styled from \"styled-components\";\nimport { emptyOutput, ModelOutput } from \"hotstuff-network\";\nimport LinePlot from \"./LinePlot\";\nimport Tabs from \"../Tabs/Tabs\";\nimport config from \"../../config\";\n\nconst { maxPlotPoints, plotDomainMarginPercent } = config;\n\nconst colors = [\n  \"#2ecc71\",\n  \"#3498db\",\n  \"#9b59b6\",\n  \"#e74c3c\",\n  \"#e67e22\",\n  \"#34495e\",\n  \"#16a085\",\n];\n\nconst StyledCharts = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 100%;\n\n  .chart {\n    width: 60% !important;\n    max-width: 900px;\n\n    @media only screen and (max-width: 600px) {\n      width: 90% !important;\n      touch-action: pan-y;\n    }\n  }\n`;\n\nconst StyledPlot = styled.div<{ height: number; width: number }>`\n  width: 100%;\n  height: ${(props) => props.height}px;\n  border-top: 3px solid black;\n  margin: 0;\n  padding: 0;\n`;\n\ntype Margin = {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n};\n\nexport type PlotDimensions = {\n  height: number;\n  width: number;\n  margin: Margin;\n};\n\ntype TimeSeriesPlotData = {\n  time: number;\n  [key: string]: number;\n};\n\ntype PlotDomain = [number, number];\n\nfunction roundToNearestTenth(input: number): number {\n  return Math.round(input * 10) / 10;\n}\n\nfunction plotShape(\n  data: ModelOutput\n): [TimeSeriesPlotData[], PlotDomain, TimeSeriesPlotData[], PlotDomain] {\n  // the number of points depends on the order of magnitude\n  const lowerMag = Math.floor(Math.log10(data.totalTimeS));\n  const divisibleBy = Math.pow(10, lowerMag - 1);\n  function include(val: number) {\n    return Math.abs(val % divisibleBy) === 0;\n  }\n\n  const includeAll = data.timeSeriesS.length < maxPlotPoints;\n\n  const tempsAtAllTimes: TimeSeriesPlotData[] = [];\n  let minTemp = 1e9;\n  let maxTemp = -1e9;\n  const heatTransfersAtAllTimes: TimeSeriesPlotData[] = [];\n  let minHeatTransfer = 1e9;\n  let maxHeatTransfer = -1e9;\n\n  data.timeSeriesS.forEach((t, idx) => {\n    if (includeAll || include(t)) {\n      const temp: TimeSeriesPlotData = { time: t };\n      const ht: TimeSeriesPlotData = { time: t };\n\n      data.nodeResults.forEach((nodeResult) => {\n        const tempVal = nodeResult.tempDegC[idx];\n        if (tempVal < minTemp) {\n          minTemp = tempVal;\n        } else if (tempVal > maxTemp) {\n          maxTemp = tempVal;\n        }\n        temp[nodeResult.node.name] = roundToNearestTenth(tempVal);\n      });\n\n      data.connectionResults.forEach((connectionResult) => {\n        const heatTransferVal = connectionResult.heatTransferW[idx];\n        if (heatTransferVal < minHeatTransfer) {\n          minHeatTransfer = heatTransferVal;\n        } else if (heatTransferVal > maxHeatTransfer) {\n          maxHeatTransfer = heatTransferVal;\n        }\n        ht[\n          `${connectionResult.connection.firstNode.name} to ${connectionResult.connection.secondNode.name}`\n        ] = roundToNearestTenth(heatTransferVal);\n      });\n\n      tempsAtAllTimes.push(temp);\n      heatTransfersAtAllTimes.push(ht);\n    }\n  });\n  return [\n    tempsAtAllTimes,\n    [minTemp, maxTemp],\n    heatTransfersAtAllTimes,\n    [minHeatTransfer, maxHeatTransfer],\n  ];\n}\n\ntype PlotProps = {\n  plotDimensions: PlotDimensions;\n  modelOutput?: ModelOutput;\n};\n\nexport default function Plot(props: PlotProps): React.ReactElement {\n  const modelHasOutput = !!(\n    props.modelOutput && props.modelOutput.nodeResults.length > 0\n  );\n  const res =\n    modelHasOutput && props.modelOutput ? props.modelOutput : emptyOutput;\n\n  const [tempPlotData, tempDomain, heatTransferPlotData, heatTransferDomain] =\n    plotShape(res);\n\n  const yTempDomainMargin =\n    (tempDomain[1] - tempDomain[0]) * plotDomainMarginPercent;\n  const yTempDomain: [number, number] | undefined = modelHasOutput\n    ? [\n        Math.floor(tempDomain[0] - yTempDomainMargin),\n        Math.ceil(tempDomain[1] + yTempDomainMargin),\n      ]\n    : undefined;\n\n  const yHeatTransferDomainMargin =\n    (heatTransferDomain[1] - heatTransferDomain[0]) * plotDomainMarginPercent;\n  const yHeatTransferDomain: [number, number] | undefined = modelHasOutput\n    ? [\n        Math.floor(heatTransferDomain[0] - yHeatTransferDomainMargin),\n        Math.ceil(heatTransferDomain[1] + yHeatTransferDomainMargin),\n      ]\n    : undefined;\n\n  const heatTransferLines = useMemo(\n    () =>\n      res.connectionResults.map((connectionResult, idx) => {\n        return (\n          <Line\n            key={connectionResult.connection.id}\n            type={\"monotone\"}\n            dataKey={`${connectionResult.connection.firstNode.name} to ${connectionResult.connection.secondNode.name}`}\n            stroke={colors[idx]}\n            activeDot={{ r: 8 }}\n            isAnimationActive={false}\n          />\n        );\n      }),\n    [res.connectionResults]\n  );\n\n  const tempLines = useMemo(\n    () =>\n      res.nodeResults.map((nodeResult, idx) => {\n        return (\n          <Line\n            key={nodeResult.node.id}\n            type={\"monotone\"}\n            dataKey={nodeResult.node.name}\n            stroke={colors[idx]}\n            activeDot={{ r: 8 }}\n            isAnimationActive={false}\n          />\n        );\n      }),\n    [res.nodeResults]\n  );\n\n  const tempPlot = (\n    <LinePlot\n      plotDimensions={props.plotDimensions}\n      plotData={tempPlotData}\n      lines={tempLines}\n      xAxisKey={\"time\"}\n      xLabel={\"Time [s]\"}\n      yLabel={\"Temperature [degC]\"}\n      yDomain={yTempDomain}\n      unit={\"degC\"}\n    />\n  );\n\n  const heatTransferPlot = (\n    <LinePlot\n      plotDimensions={props.plotDimensions}\n      plotData={heatTransferPlotData}\n      lines={heatTransferLines}\n      xAxisKey={\"time\"}\n      xLabel={\"Time [s]\"}\n      yLabel={\"Heat Transfer [Watts]\"}\n      yDomain={yHeatTransferDomain}\n      unit={\"W\"}\n    />\n  );\n\n  return (\n    <StyledPlot\n      height={props.plotDimensions.height}\n      width={props.plotDimensions.width}\n    >\n      <StyledCharts>\n        <Tabs\n          tabs={[\n            {\n              text: \"Temperature\",\n              component: tempPlot,\n              width: 0.5,\n            },\n            {\n              text: \"Heat Transfer\",\n              component: heatTransferPlot,\n              width: 0.5,\n            },\n          ]}\n        />\n      </StyledCharts>\n    </StyledPlot>\n  );\n}\n","import { diffPoints, ORIGIN, Point, scalePoint } from \"../../utils/pointUtils\";\nimport config from \"../../config\";\nimport { Direction } from \"../../App\";\nimport * as React from \"react\";\nimport { CanvasState } from \"./Canvas\";\nimport { scaleDiverging } from \"d3-scale\";\nimport { HSConnectionKind } from \"hotstuff-network\";\n\nconst { activeNodeOutlineWidthPx, minRadiusPx, maxRadiusPx } = config;\nexport const DEFAULT_RADIUS = Math.floor((minRadiusPx + maxRadiusPx) / 2);\n\nfunction drawCircle(\n  context: CanvasRenderingContext2D,\n  center: Point,\n  radius: number,\n  color: string\n): void {\n  context.save();\n  context.beginPath();\n  context.arc(center.x, center.y, radius, 0, 2 * Math.PI);\n  context.fillStyle = color;\n  context.fill();\n  context.closePath();\n  context.restore();\n}\n\nfunction drawCircleOutline(\n  context: CanvasRenderingContext2D,\n  center: Point,\n  radius: number,\n  color: string\n): void {\n  context.save();\n  context.beginPath();\n  // inset\n  context.arc(\n    center.x,\n    center.y,\n    radius - activeNodeOutlineWidthPx / 2,\n    0,\n    2 * Math.PI\n  );\n  context.lineWidth = activeNodeOutlineWidthPx;\n  context.strokeStyle = color;\n  context.stroke();\n  context.closePath();\n  context.restore();\n}\n\nfunction drawHashPattern(\n  context: CanvasRenderingContext2D,\n  center: Point,\n  radius: number\n) {\n  context.save();\n  context.lineWidth = 2;\n  context.fillStyle = \"#FFFFFF\";\n\n  const delta = 4.5;\n  const buffer = 1;\n  const circle = 2;\n\n  // save the canvas above, now transform it for ease of drawing\n  context.translate(center.x, center.y);\n  context.rotate(Math.PI / 4);\n\n  // draw horizontal line\n  context.beginPath();\n  context.moveTo(-radius, 0);\n  context.lineTo(radius, 0);\n  context.stroke();\n\n  // draw smaller horizontal lines offset vertically from center\n  let h = 0; // vertical distance from center\n  while (h + delta < radius) {\n    h = h + delta;\n    const newRadius = radius * Math.sin(Math.acos(h / radius));\n    context.moveTo(-newRadius - buffer, h);\n    context.lineTo(newRadius + buffer, h);\n    context.stroke();\n    context.moveTo(-newRadius - buffer, -h);\n    context.lineTo(newRadius + buffer, -h);\n    context.stroke();\n  }\n  context.closePath();\n\n  // clip off the extra bits around the circle\n  context.beginPath();\n  context.arc(0, 0, radius + circle, 0, Math.PI * 2, false);\n  context.arc(0, 0, radius, 0, Math.PI * 2, true);\n  context.fill();\n\n  context.restore();\n}\n\nfunction drawNodeName(\n  context: CanvasRenderingContext2D,\n  name: string,\n  center: Point,\n  radius: number,\n  textDirection: Direction\n) {\n  const bufferText = 2;\n  context.save();\n  context.font = \"14px Helvetica\";\n  const textMetrics = context.measureText(name);\n  const width = textMetrics.width;\n  context.translate(center.x, center.y);\n  if (textDirection === \"D\") {\n    context.fillText(\n      name,\n      -width / 2,\n      textMetrics.actualBoundingBoxAscent + radius + bufferText\n    );\n  } else if (textDirection === \"R\") {\n    context.fillText(\n      name,\n      radius + bufferText,\n      textMetrics.actualBoundingBoxAscent / 2\n    );\n  } else if (textDirection === \"U\") {\n    context.fillText(\n      name,\n      -width / 2,\n      -(textMetrics.actualBoundingBoxDescent + radius + bufferText)\n    );\n  } else {\n    context.fillText(\n      name,\n      -(width + radius + bufferText),\n      textMetrics.actualBoundingBoxAscent / 2\n    );\n  }\n  context.restore();\n}\n\nexport function drawNode(\n  context: CanvasRenderingContext2D,\n  name: string,\n  center: Point,\n  radius: number,\n  color: string,\n  isActive: boolean,\n  isBoundary: boolean,\n  textDirection: Direction\n): void {\n  drawCircle(context, center, radius, color);\n  if (isActive) {\n    drawCircleOutline(context, center, radius, \"black\");\n  }\n  if (isBoundary) {\n    drawHashPattern(context, center, radius);\n  }\n  drawNodeName(context, name, center, radius, textDirection);\n}\n\nexport function drawBidirectionalArrow(\n  context: CanvasRenderingContext2D,\n  start: Point,\n  end: Point,\n  color: string,\n  startOffset = 0,\n  endOffset = 0\n): void {\n  context.save();\n  context.beginPath();\n  context.strokeStyle = color;\n  context.lineWidth = 2;\n  const headLength = 9;\n  const headWidth = 4;\n  const arrowGap = 0;\n  const dx = end.x - start.x;\n  const dy = end.y - start.y;\n  const angle = Math.atan2(dy, dx);\n  const length = Math.sqrt(dx * dx + dy * dy);\n  const adjLength = length - endOffset;\n\n  context.translate(start.x, start.y);\n  context.rotate(angle);\n\n  context.beginPath();\n  context.moveTo(startOffset, arrowGap);\n  context.lineTo(adjLength, arrowGap);\n  context.moveTo(adjLength - headLength, headWidth + arrowGap);\n  context.lineTo(adjLength, arrowGap);\n  context.lineTo(adjLength - headLength, -(headWidth - arrowGap));\n\n  context.moveTo(adjLength, -arrowGap);\n  context.lineTo(startOffset, -arrowGap);\n  context.moveTo(startOffset + headLength, -(headWidth + arrowGap));\n  context.lineTo(startOffset, -arrowGap);\n  context.lineTo(startOffset + headLength, headWidth - arrowGap);\n\n  context.stroke();\n  context.closePath();\n  context.restore();\n}\n\nexport function drawUnidirectionalArrow(\n  context: CanvasRenderingContext2D,\n  start: Point,\n  end: Point,\n  color: string,\n  startOffset = 0,\n  endOffset = 0\n): void {\n  context.save();\n  context.beginPath();\n  context.strokeStyle = color;\n  context.lineWidth = 2;\n  const headLength = 9;\n  const headWidth = 4;\n  const dx = end.x - start.x;\n  const dy = end.y - start.y;\n  const angle = Math.atan2(dy, dx);\n  const length = Math.sqrt(dx * dx + dy * dy);\n  const adjLength = length - endOffset;\n\n  context.translate(start.x, start.y);\n  context.rotate(angle);\n\n  context.beginPath();\n  context.moveTo(startOffset, 0);\n  context.lineTo(adjLength, 0);\n  context.moveTo(adjLength - headLength, -headWidth);\n  context.lineTo(adjLength, 0);\n  context.lineTo(adjLength - headLength, headWidth);\n  context.stroke();\n  context.closePath();\n  context.restore();\n}\n\nexport function drawArrowWithoutHead(\n  context: CanvasRenderingContext2D,\n  start: Point,\n  end: Point,\n  color: string,\n  startOffset = 0,\n  endOffset = 0\n): void {\n  context.save();\n  context.beginPath();\n  context.strokeStyle = color;\n  context.lineWidth = 2;\n  const dx = end.x - start.x;\n  const dy = end.y - start.y;\n  const angle = Math.atan2(dy, dx);\n  const length = Math.sqrt(dx * dx + dy * dy);\n  context.translate(start.x, start.y);\n  context.rotate(angle);\n  context.beginPath();\n  context.moveTo(startOffset, 0);\n  const adjLength = length - endOffset;\n  context.lineTo(adjLength, 0);\n  context.stroke();\n  context.closePath();\n  context.restore();\n}\n\nexport function drawClearBox(\n  context: CanvasRenderingContext2D,\n  start: Point,\n  end: Point,\n  color: string\n): void {\n  context.save();\n  context.beginPath();\n  context.fillStyle = color;\n  context.globalAlpha = 0.2;\n  context.fillRect(start.x, start.y, end.x - start.x, end.y - start.y);\n  context.closePath();\n\n  // outline\n  context.beginPath();\n  context.strokeStyle = color;\n  context.rect(start.x, start.y, end.x - start.x, end.y - start.y);\n  context.stroke();\n  context.closePath();\n\n  context.restore();\n}\n\nexport function drawConnection(\n  context: CanvasRenderingContext2D,\n  firstNodeCenter: Point,\n  firstNodeRadius: number,\n  secondNodeCenter: Point,\n  secondNodeRadius: number,\n  kind: HSConnectionKind\n): void {\n  if ([\"cond\", \"conv\"].includes(kind)) {\n    drawBidirectionalArrow(\n      context,\n      firstNodeCenter,\n      secondNodeCenter,\n      \"black\",\n      firstNodeRadius,\n      secondNodeRadius\n    );\n  } else {\n    drawUnidirectionalArrow(\n      context,\n      firstNodeCenter,\n      secondNodeCenter,\n      \"black\",\n      firstNodeRadius,\n      secondNodeRadius\n    );\n  }\n}\n\nexport function intersectsCircle(\n  point: Point,\n  circleCenter: Point,\n  radius: number\n): boolean {\n  const deltaX = point.x - circleCenter.x;\n  const deltaY = point.y - circleCenter.y;\n  return Math.pow(deltaX, 2) + Math.pow(deltaY, 2) <= Math.pow(radius, 2);\n}\n\nexport function isInsideBox(\n  startBox: Point,\n  endBox: Point,\n  point: Point\n): boolean {\n  const [topLeft, bottomRight] =\n    startBox.x < endBox.x && startBox.y < endBox.y\n      ? [startBox, endBox]\n      : [endBox, startBox];\n\n  const [bottomLeft, topRight] =\n    startBox.x < endBox.x && startBox.y > endBox.y\n      ? [startBox, endBox]\n      : [endBox, startBox];\n\n  return (\n    (topLeft.x <= point.x &&\n      point.x <= bottomRight.x &&\n      topLeft.y <= point.y &&\n      point.y <= bottomRight.y) ||\n    (bottomLeft.x <= point.x &&\n      point.x <= topRight.x &&\n      topRight.y <= point.y &&\n      point.y <= bottomLeft.y)\n  );\n}\n\nexport function calculateMousePositionOnElement(\n  event: React.MouseEvent | MouseEvent,\n  element: HTMLElement\n): Point {\n  const viewportMousePos = { x: event.pageX, y: event.pageY };\n  const boundingRect = element.getBoundingClientRect();\n  const topLeftCanvasPos = { x: boundingRect.left, y: boundingRect.top };\n  return diffPoints(viewportMousePos, topLeftCanvasPos);\n}\n\nfunction canvasMouseToNodeCoords(\n  mouse: Point,\n  offset: Point,\n  scale: number\n): Point {\n  return diffPoints(scalePoint(mouse, scale), offset);\n}\n\nexport function mouseToNodeCoords(\n  event: React.MouseEvent | MouseEvent,\n  canvasState: CanvasState\n): Point {\n  if (canvasState.context) {\n    const canvasMouse = calculateMousePositionOnElement(\n      event,\n      canvasState.context.canvas\n    );\n    return canvasMouseToNodeCoords(\n      canvasMouse,\n      canvasState.canvasViewState.offset,\n      canvasState.canvasViewState.scale\n    );\n  } else {\n    return ORIGIN;\n  }\n}\n\nexport function rotatedDirection(direction: Direction): Direction {\n  // assume rotate counter-clockwise\n  if (direction === \"D\") {\n    return \"R\";\n  } else if (direction === \"R\") {\n    return \"U\";\n  } else if (direction === \"U\") {\n    return \"L\";\n  } else {\n    return \"D\";\n  }\n}\n\nexport function getCanvasCenter(\n  canvasWidth: number,\n  canvasHeight: number,\n  offset: Point,\n  scale: number\n): Point {\n  const topLeftPoint = offset;\n  const distanceToCenter = scalePoint(\n    { x: canvasWidth, y: canvasHeight },\n    2 * scale\n  );\n  return diffPoints(distanceToCenter, topLeftPoint);\n}\n\nexport function determineRadius(\n  capacitance: number,\n  allCapacitances: number[]\n): number {\n  const min = Math.min(...allCapacitances);\n  const max = Math.max(...allCapacitances);\n  // cap = min -> minRadius\n  // cap = max -> maxRadius\n  // radius = (cap - min) / (max - min) * 20 + 10\n  if (min === max) {\n    return DEFAULT_RADIUS;\n  }\n  return (\n    ((capacitance - min) / (max - min)) * (maxRadiusPx - minRadiusPx) +\n    minRadiusPx\n  );\n}\n\nexport function determineColor(\n  temperature: number,\n  allTemperatures: number[]\n): string {\n  const minTemp = Math.min(...allTemperatures);\n  const maxTemp = Math.max(...allTemperatures);\n  const range = maxTemp - minTemp;\n  const test = scaleDiverging<string>()\n    .domain([minTemp - range / 3, (minTemp + maxTemp) / 2, maxTemp + range / 3])\n    .range([\"blue\", \"#ababab\", \"red\"]);\n  return test(temperature);\n}\n","import * as React from \"react\";\nimport { useCallback, useLayoutEffect, useRef, useState } from \"react\";\nimport {\n  addPoints,\n  diffPoints,\n  ORIGIN,\n  Point,\n  scalePoint,\n} from \"../../../utils/pointUtils\";\nimport config from \"../../../config\";\nimport { calculateMousePositionOnElement } from \"../canvasUtils\";\nimport { CanvasViewState } from \"../Canvas\";\n\nconst { maxZoom, minZoom, zoomSensitivity, maxZoomDelta } = config;\n\nexport default function usePanZoomCanvas(\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  canvasViewState: CanvasViewState,\n  setCanvasViewState: (newCanvasViewState: CanvasViewState) => void\n): [\n  CanvasRenderingContext2D | null,\n  React.Dispatch<React.SetStateAction<CanvasRenderingContext2D | null>>,\n  (event: React.MouseEvent | MouseEvent) => void\n] {\n  const [context, setContext] = useState<CanvasRenderingContext2D | null>(null);\n  const mousePosRef = useRef<Point>(ORIGIN);\n  const lastMousePosRef = useRef<Point>(ORIGIN);\n  const lastCanvasViewState = useRef<CanvasViewState>(canvasViewState);\n\n  // functions for panning\n  const mouseMove = useCallback(\n    (event: React.MouseEvent | MouseEvent) => {\n      if (context) {\n        // update mouse position\n        const newMousePos = calculateMousePositionOnElement(\n          event,\n          context.canvas\n        );\n        lastMousePosRef.current = mousePosRef.current;\n        mousePosRef.current = newMousePos;\n\n        const mouseDiff = scalePoint(\n          diffPoints(mousePosRef.current, lastMousePosRef.current),\n          canvasViewState.scale\n        );\n        const newCanvasViewState = {\n          scale: canvasViewState.scale,\n          offset: addPoints(lastCanvasViewState.current.offset, mouseDiff),\n        };\n        setCanvasViewState(newCanvasViewState);\n        lastCanvasViewState.current = newCanvasViewState;\n      }\n    },\n    [context, canvasViewState.scale, setCanvasViewState]\n  );\n\n  const mouseUp = useCallback(() => {\n    document.removeEventListener(\"mousemove\", mouseMove);\n    document.removeEventListener(\"mouseup\", mouseUp);\n  }, [mouseMove]);\n\n  const startPan = useCallback(\n    (event: React.MouseEvent | MouseEvent) => {\n      if (context) {\n        document.addEventListener(\"mousemove\", mouseMove);\n        document.addEventListener(\"mouseup\", mouseUp);\n        mousePosRef.current = calculateMousePositionOnElement(\n          event,\n          context.canvas\n        );\n      }\n    },\n    [context, mouseMove, mouseUp]\n  );\n\n  // add event listener on canvas for zoom\n  useLayoutEffect(() => {\n    function handleWheel(event: WheelEvent) {\n      event.preventDefault();\n      if (context) {\n        // update mouse position\n        const newMousePos = calculateMousePositionOnElement(\n          event,\n          context.canvas\n        );\n        lastMousePosRef.current = mousePosRef.current;\n        mousePosRef.current = newMousePos;\n\n        // calculate new scale/zoom\n        const zoomDelta = event.deltaY / zoomSensitivity;\n        const zoom =\n          1 -\n          (Math.abs(zoomDelta) > maxZoomDelta\n            ? (zoomDelta / Math.abs(zoomDelta)) * maxZoomDelta\n            : zoomDelta);\n        const newScale = canvasViewState.scale * zoom;\n        if (newScale > maxZoom || newScale < minZoom) {\n          return;\n        }\n\n        // offset the canvas such that the point under the mouse doesn't move\n        const lastMouse = scalePoint(\n          mousePosRef.current,\n          canvasViewState.scale\n        );\n        const newMouse = scalePoint(mousePosRef.current, newScale);\n        const mouseOffset = diffPoints(lastMouse, newMouse);\n\n        const newCanvasViewState = {\n          offset: diffPoints(lastCanvasViewState.current.offset, mouseOffset),\n          scale: newScale,\n        };\n        setCanvasViewState(newCanvasViewState);\n        lastCanvasViewState.current = newCanvasViewState;\n      }\n    }\n\n    const canvasElem = canvasRef.current;\n    if (canvasElem) {\n      lastCanvasViewState.current = canvasViewState;\n      canvasElem.addEventListener(\"wheel\", handleWheel);\n      return () => canvasElem.removeEventListener(\"wheel\", handleWheel);\n    }\n  }, [canvasRef, canvasViewState, context, setCanvasViewState]);\n\n  return [context, setContext, startPan];\n}\n","import * as React from \"react\";\nimport styled from \"styled-components/macro\";\nimport { ORIGIN } from \"../../utils/pointUtils\";\nimport { CanvasState, CanvasViewState } from \"./Canvas\";\n\nconst StyledButtons = styled.div`\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst StyledButton = styled.button`\n  margin: 0.2em;\n`;\n\ntype CanvasControlsProps = {\n  setCanvasViewState: (canvasViewState: CanvasViewState) => void;\n  canvasState: CanvasState;\n  savedCanvasState: CanvasViewState;\n  setSavedCanvasState: (newSavedCanvasState: CanvasViewState) => void;\n};\n\nexport default function CanvasControls(\n  props: CanvasControlsProps\n): React.ReactElement {\n  return (\n    <StyledButtons>\n      <StyledButton\n        onClick={() =>\n          props.canvasState.context &&\n          props.setCanvasViewState({ offset: ORIGIN, scale: 1 })\n        }\n      >\n        Reset View\n      </StyledButton>\n      <StyledButton\n        onClick={() =>\n          props.canvasState.context &&\n          props.setCanvasViewState({\n            offset: props.savedCanvasState.offset,\n            scale: props.savedCanvasState.scale,\n          })\n        }\n      >\n        Reset View to Saved\n      </StyledButton>\n      <StyledButton\n        onClick={() => {\n          props.setSavedCanvasState({\n            offset: props.canvasState.canvasViewState.offset,\n            scale: props.canvasState.canvasViewState.scale,\n          });\n        }}\n      >\n        Save View\n      </StyledButton>\n    </StyledButtons>\n  );\n}\n","import * as React from \"react\";\nimport { ModalState } from \"../../App\";\nimport styled from \"styled-components/macro\";\n\nconst StyledModalControls = styled.div`\n  position: absolute;\n  right: 10px;\n  top: 10px;\n`;\n\nconst StyledModalControlButton = styled.button`\n  margin-left: 1em;\n`;\n\ntype ModalControlsProps = {\n  setModalState: React.Dispatch<React.SetStateAction<ModalState>>;\n};\n\nexport default function ModalControls(\n  props: ModalControlsProps\n): React.ReactElement {\n  const { setModalState } = props;\n\n  return (\n    <StyledModalControls>\n      <StyledModalControlButton\n        onClick={() => setModalState({ visible: true, type: \"theory\" })}\n      >\n        Theory\n      </StyledModalControlButton>\n      <StyledModalControlButton\n        onClick={() => setModalState({ visible: true, type: \"tutorial\" })}\n      >\n        Tutorial\n      </StyledModalControlButton>\n      <StyledModalControlButton\n        onClick={() => setModalState({ visible: true, type: \"about\" })}\n      >\n        About\n      </StyledModalControlButton>\n    </StyledModalControls>\n  );\n}\n","import * as React from \"react\";\nimport { useLayoutEffect, useRef } from \"react\";\nimport styled from \"styled-components\";\nimport usePanZoomCanvas from \"./hooks/usePanZoomCanvas\";\nimport { Point } from \"../../utils/pointUtils\";\nimport CanvasControls from \"./CanvasControls\";\nimport useOnClickCanvas from \"./hooks/useOnClickCanvas\";\nimport { ModalState } from \"../../App\";\nimport ModalControls from \"./ModalControls\";\n\nconst StyledCanvasWrapper = styled.div`\n  display: block;\n  max-height: 100%;\n  position: relative;\n`;\n\nconst StyledCanvas = styled.canvas<{ cssWidth: number; cssHeight: number }>`\n  width: ${({ cssWidth }) => `${cssWidth}px`};\n  height: ${({ cssHeight }) => `${cssHeight}px`};\n`;\n\nexport type CanvasViewState = {\n  offset: Point;\n  scale: number;\n};\n\nexport type CanvasState = {\n  context: CanvasRenderingContext2D | null;\n  canvasViewState: CanvasViewState;\n  canvasWidth: number;\n  canvasHeight: number;\n};\n\nexport type CanvasProps = {\n  canvasWidth: number;\n  canvasHeight: number;\n  devicePixelRatio: number;\n  draw: (context: CanvasRenderingContext2D) => void;\n  onMouseDown: (\n    event: React.MouseEvent | MouseEvent,\n    canvasState: CanvasState,\n    defaultBehavior: (event: React.MouseEvent | MouseEvent) => void\n  ) => void;\n  handleDoubleClick: (\n    event: React.MouseEvent,\n    canvasState: CanvasState\n  ) => void;\n  canvasViewState: CanvasViewState;\n  setCanvasViewState: (newCanvasState: CanvasViewState) => void;\n  savedCanvasViewState: CanvasViewState;\n  setSavedCanvasViewState: (newSavedCanvasState: CanvasViewState) => void;\n  setKeyboardActive: React.Dispatch<React.SetStateAction<boolean>>;\n  setModalState: React.Dispatch<React.SetStateAction<ModalState>>;\n};\n\nexport default function Canvas(props: CanvasProps): React.ReactElement {\n  const {\n    canvasWidth,\n    canvasHeight,\n    devicePixelRatio,\n    draw,\n    onMouseDown,\n    handleDoubleClick,\n    canvasViewState,\n    setCanvasViewState,\n    savedCanvasViewState,\n    setSavedCanvasViewState,\n    setKeyboardActive,\n    setModalState,\n  } = props;\n\n  // hooks\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  useOnClickCanvas(canvasRef, setKeyboardActive);\n  const [context, setContext, startPan] = usePanZoomCanvas(\n    canvasRef,\n    canvasViewState,\n    setCanvasViewState\n  );\n\n  // setup canvas and set context\n  useLayoutEffect(() => {\n    if (canvasRef.current) {\n      // get new drawing context\n      const renderCtx = canvasRef.current.getContext(\"2d\");\n      setContext(renderCtx);\n    }\n  }, [setContext]);\n\n  // draw\n  useLayoutEffect(() => {\n    if (context) {\n      // clear canvas\n      context.canvas.width = canvasWidth * devicePixelRatio;\n      context.canvas.height = canvasHeight * devicePixelRatio;\n\n      context.scale(\n        canvasViewState.scale * devicePixelRatio,\n        canvasViewState.scale * devicePixelRatio\n      );\n      context.translate(canvasViewState.offset.x, canvasViewState.offset.y);\n\n      draw(context);\n    }\n  }, [\n    canvasHeight,\n    canvasWidth,\n    context,\n    devicePixelRatio,\n    draw,\n    canvasViewState.offset.x,\n    canvasViewState.offset.y,\n    canvasViewState.scale,\n  ]);\n\n  return (\n    <StyledCanvasWrapper>\n      <ModalControls setModalState={setModalState} />\n      <CanvasControls\n        setCanvasViewState={setCanvasViewState}\n        canvasState={{\n          context,\n          canvasViewState,\n          canvasWidth,\n          canvasHeight,\n        }}\n        savedCanvasState={savedCanvasViewState}\n        setSavedCanvasState={setSavedCanvasViewState}\n      />\n      <StyledCanvas\n        ref={canvasRef}\n        width={canvasWidth * devicePixelRatio}\n        height={canvasHeight * devicePixelRatio}\n        cssWidth={canvasWidth}\n        cssHeight={canvasHeight}\n        onMouseDown={(event: React.MouseEvent | MouseEvent) =>\n          onMouseDown(\n            event,\n            { context, canvasViewState, canvasWidth, canvasHeight },\n            () => startPan(event)\n          )\n        }\n        onDoubleClick={(event: React.MouseEvent) =>\n          handleDoubleClick(event, {\n            context,\n            canvasViewState,\n            canvasWidth,\n            canvasHeight,\n          })\n        }\n      />\n    </StyledCanvasWrapper>\n  );\n}\n","import * as React from \"react\";\nimport { useEffect } from \"react\";\n\nexport default function useOnClickCanvas(\n  ref: React.RefObject<HTMLCanvasElement>,\n  onClickCanvas: React.Dispatch<React.SetStateAction<boolean>>\n): void {\n  useEffect(() => {\n    const handleClickOutside = (event: React.MouseEvent | MouseEvent) => {\n      const keyBoardActive =\n        !!ref.current && ref.current.contains(event.target as Node);\n      onClickCanvas(keyBoardActive);\n    };\n\n    // Bind the event listener\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      // Unbind the event listener on clean up\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, [ref, onClickCanvas]);\n}\n","import { useCallback } from \"react\";\nimport {\n  determineColor,\n  determineRadius,\n  drawConnection,\n  drawNode,\n} from \"../components/Canvas/canvasUtils\";\nimport { AppConnection, AppNode } from \"../App\";\nimport { CanvasState } from \"../components/Canvas/Canvas\";\n\nexport default function useDraw(\n  appNodes: AppNode[],\n  appConnections: AppConnection[]\n): [\n  (context: CanvasRenderingContext2D) => void,\n  (canvasState: CanvasState) => void\n] {\n  const draw = useCallback(\n    (context: CanvasRenderingContext2D) => {\n      appNodes.forEach((node) => {\n        const nodeRadius = determineRadius(\n          node.capacitanceJPerDegK,\n          appNodes.map((node) => node.capacitanceJPerDegK)\n        );\n        const nodeColor = determineColor(\n          node.temperatureDegC,\n          appNodes.map((node) => node.temperatureDegC)\n        );\n        drawNode(\n          context,\n          node.name,\n          node.center,\n          nodeRadius,\n          nodeColor,\n          node.isActive,\n          node.isBoundary,\n          node.textDirection\n        );\n      });\n\n      appConnections.map((conn) => {\n        const { firstNode, secondNode, kind } = conn;\n        const firstNodeAppNode = appNodes.find(\n          (node) => node.id === firstNode.id\n        );\n        const secondNodeAppNode = appNodes.find(\n          (node) => node.id === secondNode.id\n        );\n        if (firstNodeAppNode && secondNodeAppNode) {\n          const firstNodeRadius = determineRadius(\n            firstNodeAppNode.capacitanceJPerDegK,\n            appNodes.map((node) => node.capacitanceJPerDegK)\n          );\n          const secondNodeRadius = determineRadius(\n            secondNodeAppNode.capacitanceJPerDegK,\n            appNodes.map((node) => node.capacitanceJPerDegK)\n          );\n          drawConnection(\n            context,\n            firstNodeAppNode.center,\n            firstNodeRadius,\n            secondNodeAppNode.center,\n            secondNodeRadius,\n            kind\n          );\n        }\n      });\n    },\n    [appConnections, appNodes]\n  );\n\n  const clearAndRedraw = useCallback(\n    (canvasState: CanvasState) => {\n      if (canvasState.context) {\n        canvasState.context.clearRect(\n          -canvasState.canvasViewState.offset.x,\n          -canvasState.canvasViewState.offset.y,\n          canvasState.canvasWidth / canvasState.canvasViewState.scale,\n          canvasState.canvasHeight / canvasState.canvasViewState.scale\n        );\n        draw(canvasState.context);\n      }\n    },\n    [draw]\n  );\n\n  return [draw, clearAndRedraw];\n}\n","import React, { useCallback } from \"react\";\nimport { CanvasState } from \"../components/Canvas/Canvas\";\nimport {\n  determineRadius,\n  drawArrowWithoutHead,\n  intersectsCircle,\n  mouseToNodeCoords,\n} from \"../components/Canvas/canvasUtils\";\nimport { AppConnection, AppNode } from \"../App\";\nimport { getNewConnection } from \"../utils/nodeConnectionUtils\";\n\nexport default function useAddConnection(\n  appNodes: AppNode[],\n  appConnections: AppConnection[],\n  addConnection: (newConnection: AppConnection) => void,\n  clearAndRedraw: (canvasState: CanvasState) => void\n): (\n  event: React.MouseEvent | MouseEvent,\n  clickedNode: AppNode,\n  canvasState: CanvasState\n) => void {\n  const drawConnectionBeingMade = useCallback(\n    (\n      event: React.MouseEvent | MouseEvent,\n      clickedNode: AppNode,\n      canvasState: CanvasState\n    ) => {\n      if (canvasState.context) {\n        const nodeCoordsOfMouse = mouseToNodeCoords(event, canvasState);\n        clearAndRedraw(canvasState);\n        drawArrowWithoutHead(\n          canvasState.context,\n          clickedNode.center,\n          nodeCoordsOfMouse,\n          \"grey\"\n        );\n      }\n    },\n    [clearAndRedraw]\n  );\n\n  return useCallback(\n    (\n      event: React.MouseEvent | MouseEvent,\n      clickedNode: AppNode,\n      canvasState: CanvasState\n    ) => {\n      const drawConnWrapper = (event: React.MouseEvent | MouseEvent) => {\n        drawConnectionBeingMade(event, clickedNode, canvasState);\n      };\n\n      const mouseUp = (event: React.MouseEvent | MouseEvent) => {\n        document.removeEventListener(\"mousemove\", drawConnWrapper);\n        document.removeEventListener(\"mouseup\", mouseUp);\n\n        // if arrow released on a node, make new connection\n        const nodeCoordsOfMouse = mouseToNodeCoords(event, canvasState);\n        const mouseUpOnNode = appNodes.find((node) => {\n          const nodeRadius = determineRadius(\n            node.capacitanceJPerDegK,\n            appNodes.map((node) => node.capacitanceJPerDegK)\n          );\n          return (\n            intersectsCircle(nodeCoordsOfMouse, node.center, nodeRadius) &&\n            node.id !== clickedNode.id\n          );\n        });\n\n        if (mouseUpOnNode) {\n          const newConnection = getNewConnection(\n            clickedNode,\n            mouseUpOnNode,\n            appConnections\n          );\n          if (!!newConnection) {\n            addConnection(newConnection);\n          } else {\n            clearAndRedraw(canvasState);\n          }\n        } else {\n          clearAndRedraw(canvasState);\n        }\n      };\n      document.addEventListener(\"mousemove\", drawConnWrapper);\n      document.addEventListener(\"mouseup\", mouseUp);\n    },\n    [\n      addConnection,\n      appConnections,\n      appNodes,\n      clearAndRedraw,\n      drawConnectionBeingMade,\n    ]\n  );\n}\n","import React, { useCallback, useRef } from \"react\";\nimport { CanvasState } from \"../components/Canvas/Canvas\";\nimport { mouseToNodeCoords } from \"../components/Canvas/canvasUtils\";\nimport { AppNode } from \"../App\";\nimport { diffPoints } from \"../utils/pointUtils\";\nimport config from \"../config\";\n\nfunction getNewAppNodes(\n  clickedMouseEvent: React.MouseEvent | MouseEvent,\n  currentMouseEvent: React.MouseEvent | MouseEvent,\n  canvasState: CanvasState,\n  clickedNode: AppNode,\n  multiSelectKeyPressed: boolean,\n  activeNodes: AppNode[]\n): AppNode[] {\n  const offsetMouseToCenter = diffPoints(\n    mouseToNodeCoords(clickedMouseEvent, canvasState),\n    clickedNode.center\n  );\n\n  const newClickedCenter = diffPoints(\n    mouseToNodeCoords(currentMouseEvent, canvasState),\n    offsetMouseToCenter\n  );\n\n  const newClickedNode = {\n    ...clickedNode,\n    isActive: true,\n    center: newClickedCenter,\n  };\n\n  const newActiveNodes =\n    clickedNode.isActive || multiSelectKeyPressed\n      ? activeNodes.map((node) => {\n          const distanceFromClickedCenter = diffPoints(\n            clickedNode.center,\n            node.center\n          );\n          return {\n            ...node,\n            center: diffPoints(newClickedCenter, distanceFromClickedCenter),\n          };\n        })\n      : [];\n\n  return [newClickedNode, ...newActiveNodes];\n}\n\nexport default function useMoveNode(\n  updateNodes: (nodesToUpdate: AppNode[], clearActiveNodes?: boolean) => void\n): (\n  event: React.MouseEvent | MouseEvent,\n  clickedNode: AppNode,\n  activeNodes: AppNode[],\n  canvasState: CanvasState\n) => void {\n  const movedRef = useRef<boolean>(false);\n\n  return useCallback(\n    (\n      mouseDownEvent: React.MouseEvent | MouseEvent,\n      clickedNode: AppNode,\n      activeNodes: AppNode[],\n      canvasState: CanvasState\n    ) => {\n      const multiSelectKeyPressed = config.multiSelectKeys.some(\n        (k) => mouseDownEvent[k]\n      );\n      const moveNode = (currentMouseEvent: React.MouseEvent | MouseEvent) => {\n        if (canvasState.context) {\n          movedRef.current = true;\n          const newNodes = getNewAppNodes(\n            mouseDownEvent,\n            currentMouseEvent,\n            canvasState,\n            clickedNode,\n            multiSelectKeyPressed,\n            activeNodes\n          );\n          updateNodes(\n            newNodes,\n            !config.multiSelectKeys.some((k) => currentMouseEvent[k])\n          );\n        }\n      };\n      const mouseUp = (mouseUpEvent: React.MouseEvent | MouseEvent) => {\n        document.removeEventListener(\"mousemove\", moveNode);\n        document.removeEventListener(\"mouseup\", mouseUp);\n        const newNodes = getNewAppNodes(\n          mouseDownEvent,\n          mouseUpEvent,\n          canvasState,\n          clickedNode,\n          multiSelectKeyPressed,\n          activeNodes\n        );\n        updateNodes(newNodes, !multiSelectKeyPressed);\n        movedRef.current = false;\n      };\n      document.addEventListener(\"mousemove\", moveNode);\n      document.addEventListener(\"mouseup\", mouseUp);\n    },\n    [updateNodes]\n  );\n}\n","import React, { useCallback } from \"react\";\nimport { CanvasState } from \"../components/Canvas/Canvas\";\nimport {\n  drawClearBox,\n  isInsideBox,\n  mouseToNodeCoords,\n} from \"../components/Canvas/canvasUtils\";\nimport { AppNode } from \"../App\";\n\nexport default function useMultiSelect(\n  appNodes: AppNode[],\n  setActiveNodes: (activeNodeIds: string[]) => void,\n  clearAndRedraw: (canvasState: CanvasState) => void\n): (event: React.MouseEvent | MouseEvent, canvasState: CanvasState) => void {\n  return useCallback(\n    (event: React.MouseEvent | MouseEvent, canvasState: CanvasState) => {\n      const boxStart = mouseToNodeCoords(event, canvasState);\n      const drawBox = (event: React.MouseEvent | MouseEvent) => {\n        if (canvasState.context) {\n          clearAndRedraw(canvasState);\n          drawClearBox(\n            canvasState.context,\n            boxStart,\n            mouseToNodeCoords(event, canvasState),\n            \"grey\"\n          );\n        }\n      };\n      const mouseUp = (event: React.MouseEvent | MouseEvent) => {\n        document.removeEventListener(\"mousemove\", drawBox);\n        document.removeEventListener(\"mouseup\", mouseUp);\n\n        const boxEnd = mouseToNodeCoords(event, canvasState);\n        const activeNodeIds = appNodes\n          .filter(\n            (node) =>\n              isInsideBox(boxStart, boxEnd, node.center) || node.isActive\n          )\n          .map((node) => node.id);\n        setActiveNodes(activeNodeIds);\n      };\n      document.addEventListener(\"mousemove\", drawBox);\n      document.addEventListener(\"mouseup\", mouseUp);\n    },\n    [appNodes, clearAndRedraw, setActiveNodes]\n  );\n}\n","import * as React from \"react\";\nimport { useCallback } from \"react\";\nimport {\n  determineRadius,\n  intersectsCircle,\n  mouseToNodeCoords,\n} from \"../components/Canvas/canvasUtils\";\nimport { AppConnection, AppNode } from \"../App\";\nimport { CanvasState } from \"../components/Canvas/Canvas\";\nimport useAddConnection from \"./useAddConnection\";\nimport useMoveNode from \"./useMoveNode\";\nimport useMultiSelect from \"./useMultiSelect\";\nimport config from \"../config\";\n\nexport default function useOnMouseDown(\n  appNodes: AppNode[],\n  appConnections: AppConnection[],\n  addConnection: (newConnection: AppConnection) => void,\n  updateNodes: (nodesToUpdate: AppNode[], clearActiveNodes?: boolean) => void,\n  setActiveNodes: (activeNodeIds: string[]) => void,\n  clearActiveNodes: () => void,\n  clearAndRedraw: (canvasState: CanvasState) => void\n): (\n  event: React.MouseEvent | MouseEvent,\n  canvasState: CanvasState,\n  defaultBehavior: (event: React.MouseEvent | MouseEvent) => void\n) => void {\n  const makeNewConnection = useAddConnection(\n    appNodes,\n    appConnections,\n    addConnection,\n    clearAndRedraw\n  );\n  const moveNode = useMoveNode(updateNodes);\n  const multiSelect = useMultiSelect(appNodes, setActiveNodes, clearAndRedraw);\n\n  return useCallback(\n    (\n      mouseDownEvent: React.MouseEvent | MouseEvent,\n      canvasState: CanvasState,\n      defaultBehavior: (event: React.MouseEvent | MouseEvent) => void\n    ) => {\n      const nodeCoordsOfMouse = mouseToNodeCoords(mouseDownEvent, canvasState);\n\n      const activeNodes = appNodes.filter((node) => node.isActive);\n      const activeNodeIds = activeNodes.map((node) => node.id);\n\n      const clickedNode = appNodes.find((node) => {\n        const nodeRadius = determineRadius(\n          node.capacitanceJPerDegK,\n          appNodes.map((node) => node.capacitanceJPerDegK)\n        );\n        return intersectsCircle(nodeCoordsOfMouse, node.center, nodeRadius);\n      });\n\n      if (clickedNode) {\n        if (mouseDownEvent.altKey) {\n          makeNewConnection(mouseDownEvent, clickedNode, canvasState);\n        } else if (\n          config.multiSelectKeys.some((k) => mouseDownEvent[k]) &&\n          activeNodeIds.includes(clickedNode.id)\n        ) {\n          setActiveNodes(activeNodeIds.filter((id) => id !== clickedNode.id));\n        } else {\n          moveNode(mouseDownEvent, clickedNode, activeNodes, canvasState);\n        }\n      } else {\n        if (config.multiSelectKeys.some((k) => mouseDownEvent[k])) {\n          multiSelect(mouseDownEvent, canvasState);\n        } else {\n          // only clear active nodes if click with no pan\n          const onMouseUp = (mouseUpEvent: React.MouseEvent | MouseEvent) => {\n            if (\n              mouseUpEvent.clientX === mouseDownEvent.clientX &&\n              mouseUpEvent.clientY === mouseDownEvent.clientY\n            ) {\n              clearActiveNodes();\n            }\n            document.removeEventListener(\"mouseup\", onMouseUp);\n          };\n          document.addEventListener(\"mouseup\", onMouseUp);\n          defaultBehavior(mouseDownEvent);\n        }\n      }\n    },\n    [\n      appNodes,\n      clearActiveNodes,\n      moveNode,\n      multiSelect,\n      makeNewConnection,\n      setActiveNodes,\n    ]\n  );\n}\n","import * as React from \"react\";\nimport { useRef } from \"react\";\nimport { diffPoints, Point } from \"../utils/pointUtils\";\n\nexport default function useClickAndDragElement(params: {\n  onDragX?: (deltaXPx: number) => void;\n  onDragY?: (deltaYPx: number) => void;\n  constrainX?: (newYPx: number) => number;\n  constrainY?: (newYPx: number) => number;\n}): (mouseDownEvent: React.MouseEvent | MouseEvent) => void {\n  const lastMousePos = useRef<Point | undefined>(undefined);\n\n  const { onDragX, onDragY, constrainX, constrainY } = params;\n\n  const onMouseUp = () => {\n    document.removeEventListener(\"mousemove\", onMouseMove);\n    document.removeEventListener(\"mouseup\", onMouseUp);\n  };\n\n  const onMouseMove = (mouseMoveEvent: React.MouseEvent | MouseEvent) => {\n    if (lastMousePos.current) {\n      const currentMousePos = {\n        x: mouseMoveEvent.pageX,\n        y: mouseMoveEvent.pageY,\n      };\n      const diff = diffPoints(currentMousePos, lastMousePos.current);\n      onDragX && onDragX(diff.x);\n      onDragY && onDragY(diff.y);\n      lastMousePos.current = {\n        x: constrainX ? constrainX(currentMousePos.x) : currentMousePos.x,\n        y: constrainY ? constrainY(currentMousePos.y) : currentMousePos.y,\n      };\n    }\n  };\n\n  return (mouseDownEvent: React.MouseEvent | MouseEvent) => {\n    document.addEventListener(\"mousemove\", onMouseMove);\n    document.addEventListener(\"mouseup\", onMouseUp);\n    lastMousePos.current = { x: mouseDownEvent.pageX, y: mouseDownEvent.pageY };\n  };\n}\n","import * as React from \"react\";\nimport { useCallback, useRef } from \"react\";\nimport useClickAndDragElement from \"./useClickAndDragElement\";\nimport { AppState } from \"../App\";\nimport config from \"../config\";\n\nfunction constrainPanelSize(newPanelSize: number): number {\n  return newPanelSize < config.minPanelFraction\n    ? config.minPanelFraction\n    : newPanelSize > 1 - config.minPanelFraction\n    ? 1 - config.minPanelFraction\n    : newPanelSize;\n}\n\nexport default function useResizablePanels(\n  setAppState: React.Dispatch<React.SetStateAction<AppState>>,\n  windowHeight: number,\n  windowWidth: number\n): [\n  React.MutableRefObject<null>,\n  (mouseDownEvent: MouseEvent | React.MouseEvent<Element, MouseEvent>) => void,\n  React.MutableRefObject<null>,\n  (mouseDownEvent: MouseEvent | React.MouseEvent<Element, MouseEvent>) => void,\n  React.MutableRefObject<null>,\n  (mouseDownEvent: MouseEvent | React.MouseEvent<Element, MouseEvent>) => void\n] {\n  const constrainX = useCallback(\n    (newX: number) => {\n      const minPx = windowWidth * config.minPanelFraction;\n      const maxPx = windowWidth * (1 - config.minPanelFraction);\n      if (newX < minPx) {\n        return minPx;\n      } else if (newX > maxPx) {\n        return maxPx;\n      } else {\n        return newX;\n      }\n    },\n    [windowWidth]\n  );\n\n  const constrainY = useCallback(\n    (newY: number) => {\n      const minPx = windowHeight * config.minPanelFraction;\n      const maxPx = windowHeight * (1 - config.minPanelFraction);\n      if (newY < minPx) {\n        return minPx;\n      } else if (newY > maxPx) {\n        return maxPx;\n      } else {\n        return newY;\n      }\n    },\n    [windowHeight]\n  );\n\n  const canvasPlotBorderRef = useRef(null);\n  const onDragYCanvasPlot = useCallback(\n    (deltaYPx: number) => {\n      setAppState((prevAppState) => ({\n        ...prevAppState,\n        panelSizes: {\n          ...prevAppState.panelSizes,\n          canvasHeightFraction: constrainPanelSize(\n            prevAppState.panelSizes.canvasHeightFraction +\n              deltaYPx / windowHeight\n          ),\n        },\n      }));\n    },\n    [setAppState, windowHeight]\n  );\n  const onMouseDownOnCanvasPlotBorder = useClickAndDragElement({\n    onDragY: onDragYCanvasPlot,\n    constrainY,\n  });\n\n  const leftRightBorderRef = useRef(null);\n  const onDragXLeftRight = useCallback(\n    (deltaXPx: number) => {\n      setAppState((prevAppState) => ({\n        ...prevAppState,\n        panelSizes: {\n          ...prevAppState.panelSizes,\n          editorWidthFraction: constrainPanelSize(\n            prevAppState.panelSizes.editorWidthFraction - deltaXPx / windowWidth\n          ),\n        },\n      }));\n    },\n    [setAppState, windowWidth]\n  );\n  const onMouseDownOnLeftRightBorder = useClickAndDragElement({\n    onDragX: onDragXLeftRight,\n    constrainX,\n  });\n\n  const tableControlsBorderRef = useRef(null);\n  const onDragYTableControls = useCallback(\n    (deltaYPx: number) => {\n      setAppState((prevAppState) => ({\n        ...prevAppState,\n        panelSizes: {\n          ...prevAppState.panelSizes,\n          tableHeightFraction: constrainPanelSize(\n            prevAppState.panelSizes.tableHeightFraction +\n              deltaYPx / windowHeight\n          ),\n        },\n      }));\n    },\n    [setAppState, windowHeight]\n  );\n  const onMouseDownOnTableControlsBorder = useClickAndDragElement({\n    onDragY: onDragYTableControls,\n    constrainY,\n  });\n\n  return [\n    canvasPlotBorderRef,\n    onMouseDownOnCanvasPlotBorder,\n    leftRightBorderRef,\n    onMouseDownOnLeftRightBorder,\n    tableControlsBorderRef,\n    onMouseDownOnTableControlsBorder,\n  ];\n}\n","import styled from \"styled-components/macro\";\n\nexport const StyledApp = styled.div<{ height: number; modalOpen: boolean }>`\n  display: flex;\n  height: ${(props) => props.height}px;\n  filter: ${(props) => (props.modalOpen ? \"blur(5px)\" : \"unset\")};\n  pointer-events: ${(props) => (props.modalOpen ? \"none\" : \"unset\")};\n  user-select: none;\n  -webkit-user-select: none; /* Chrome/Safari */\n  -moz-user-select: none; /* Firefox */\n  -ms-user-select: none; /* IE10+ */\n`;\n\nexport const StyledDraggableBorder = styled.div`\n  position: absolute;\n  z-index: 1;\n`;\n\nexport const StyledHorizontalBorder = styled(StyledDraggableBorder)<{\n  width: number;\n  y: number;\n  left: number;\n}>`\n  width: ${(props) => props.width * 100}%;\n  height: 10px;\n  top: ${(props) => props.y * 100}%;\n  transform: translate(0, -5px);\n  cursor: row-resize;\n  left: ${(props) => props.left * 100}%;\n`;\n\nexport const StyledVerticalBorder = styled(StyledDraggableBorder)<{\n  x: number;\n}>`\n  height: 100%;\n  width: 10px;\n  left: ${(props) => props.x * 100}%;\n  transform: translate(-5px, 0);\n  cursor: col-resize;\n`;\n\nexport const StyledWorkspace = styled.div<{ height: number; width: number }>`\n  height: ${(props) => props.height}px;\n  width: ${(props) => props.width}px;\n`;\n\nexport const StyledCanvas = styled.div<{ height: number }>`\n  width: 100%;\n  height: ${(props) => props.height}px;\n`;\n","import * as React from \"react\";\nimport { ModalState } from \"../../App\";\nimport styled from \"styled-components/macro\";\n\nconst StyledConfirmationModal = styled.div`\n  display: flex;\n  flex-direction: column;\n  margin: 2em;\n  justify-content: center;\n  align-items: center;\n  line-height: 1.8em;\n`;\n\nconst StyledConfirmationText = styled.p`\n  margin: 0.8em;\n  font-size: 1.5em;\n  font-weight: bold;\n  max-width: 800px;\n  text-align: center;\n`;\n\nconst StyledConfirmationButtons = styled.div`\n  display: flex;\n`;\n\nconst StyledConfirmationButton = styled.button`\n  font-size: 1.5em;\n  margin-left: 1em;\n  margin-right: 1em;\n  min-width: 100px;\n`;\n\ntype ConfirmationModalProps = {\n  modalState: ModalState;\n  setModalState: React.Dispatch<React.SetStateAction<ModalState>>;\n};\n\nexport default function ConfirmationModal(\n  props: ConfirmationModalProps\n): React.ReactElement {\n  const { modalState, setModalState } = props;\n\n  return (\n    <StyledConfirmationModal>\n      {modalState.confirmText &&\n        modalState.confirmText.map((text) => (\n          <StyledConfirmationText key={text}>{text}</StyledConfirmationText>\n        ))}\n      <StyledConfirmationButtons>\n        <StyledConfirmationButton\n          onClick={() => setModalState((prev) => ({ ...prev, visible: false }))}\n        >\n          No\n        </StyledConfirmationButton>\n        <StyledConfirmationButton\n          onClick={() => {\n            modalState.onConfirm && modalState.onConfirm();\n            setModalState((prev) => ({ ...prev, visible: false }));\n          }}\n        >\n          Yes\n        </StyledConfirmationButton>\n      </StyledConfirmationButtons>\n    </StyledConfirmationModal>\n  );\n}\n","import * as React from \"react\";\nimport styled from \"styled-components/macro\";\nimport { MathComponent } from \"mathjax-react\";\n\nconst StyledTheoryModal = styled.div`\n  max-width: 1200px;\n  height: 100%;\n  overflow-y: auto;\n  padding: 3em;\n  border-left: 1px solid black;\n  border-right: 1px solid black;\n`;\n\nconst StyledTitle = styled.h1``;\n\nconst StyledText = styled.p``;\n\nconst StyledLink = styled.a``;\n\nconst StyledListItem = styled.li`\n  margin-bottom: 1em;\n`;\n\nexport default function TheoryModal(): React.ReactElement {\n  return (\n    <StyledTheoryModal>\n      <StyledTitle>How Does thermalmodel.com Work?</StyledTitle>\n\n      <StyledText>\n        The model used by thermalmodel.com is a linear{\" \"}\n        <StyledLink\n          href={\"https://en.wikipedia.org/wiki/State-space_representation\"}\n          target={\"_blank\"}\n        >\n          state space\n        </StyledLink>{\" \"}\n        model based off conservation of heat flow:{\" \"}\n      </StyledText>\n\n      <MathComponent\n        display={true}\n        tex={String.raw`\\sum{q_{in/out}} + \\sum{q_{generated/consumed}} = 0`}\n      />\n\n      <ul>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\sum{q_{in/out}}`} />{\" \"}\n          is the sum of all heat transfer in or out in Watts{\" \"}\n          <MathComponent display={false} tex={String.raw`[W]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent\n            display={false}\n            tex={String.raw`\\sum{q_{generated/consumed}}`}\n          />{\" \"}\n          is the sum of all heat generated or consumed, in Watts{\" \"}\n          <MathComponent display={false} tex={String.raw`[W]`} />\n        </StyledListItem>\n      </ul>\n\n      <StyledText>\n        The class of model is referred to as a{\" \"}\n        <StyledLink\n          href={\n            \"https://en.wikipedia.org/wiki/Lumped-element_model#Thermal_systems\"\n          }\n          target={\"_blank\"}\n        >\n          Lumped-Element model\n        </StyledLink>\n        , which produces accurate results when each &quot;lump&quot;, or in the\n        terminology of this tool, &quot;node&quot;, can be assumed to have\n        uniform temperature. A node can be assumed to be uniform temperature\n        when the diffusion of heat energy within it is much greater than the\n        transfer of heat into or out of it. This is quantified by a small{\" \"}\n        <StyledLink\n          href={\"https://en.wikipedia.org/wiki/Biot_number\"}\n          target={\"_blank\"}\n        >\n          Biot number\n        </StyledLink>\n        .\n      </StyledText>\n\n      <StyledText>\n        What follows is the definition and manipulation of fundamental heat\n        transfer equations into the numerical form thermalmodel.com uses to\n        calculate node temperatures when it runs a model.\n      </StyledText>\n\n      <StyledText>\n        <StyledLink\n          href={\n            \"https://en.wikipedia.org/wiki/Thermal_conduction#Fourier's_law\"\n          }\n          target={\"_blank\"}\n        >\n          Fourier&apos;s Law in 1 dimension\n        </StyledLink>{\" \"}\n        states:\n      </StyledText>\n\n      <MathComponent display={true} tex={String.raw`q =-c \\Delta T`} />\n\n      <ul>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`q`} /> is heat transfer\n          in Watts <MathComponent display={false} tex={String.raw`[W]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`c`} /> is{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Thermal_contact_conductance\"}\n            target={\"_blank\"}\n          >\n            Thermal Conductance\n          </StyledLink>{\" \"}\n          or{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Thermal_transmittance\"}\n            target={\"_blank\"}\n          >\n            Thermal Transmittance\n          </StyledLink>{\" \"}\n          in Watts per degree Kelvin{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{W}{K}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\Delta T`} /> is the\n          temperature difference in degrees{\" \"}\n          <MathComponent display={false} tex={String.raw`[K]`} />\n        </StyledListItem>\n      </ul>\n\n      <StyledText>\n        The reciprocal of Thermal Conductance is{\" \"}\n        <StyledLink\n          href={\"https://en.wikipedia.org/wiki/Thermal_resistance\"}\n          target={\"_blank\"}\n        >\n          Thermal Resistance\n        </StyledLink>{\" \"}\n        , <MathComponent display={false} tex={String.raw`R = \\frac{1}{c}`} />,\n        measured in degrees Kelvin per Watt{\" \"}\n        <MathComponent display={false} tex={String.raw`[\\frac{K}{W}]`} />. For a\n        given object or material, this can be thought of as the temperature\n        difference required to get one Watt of heat energy to flow through it.\n        Materials with higher thermal resistance require more of a temperature\n        difference to achieve the same heat flow.\n      </StyledText>\n\n      <MathComponent display={true} tex={String.raw`q = -\\frac{\\Delta T}{R}`} />\n\n      <ul>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`q`} /> is heat transfer\n          in Watts <MathComponent display={false} tex={String.raw`[W]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\Delta T`} /> is the\n          temperature difference in degrees{\" \"}\n          <MathComponent display={false} tex={String.raw`[K]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`R`} /> is{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Thermal_resistance\"}\n            target={\"_blank\"}\n          >\n            Thermal Resistance\n          </StyledLink>{\" \"}\n          in degrees Kelvin per Watt{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{K}{W}]`} />\n        </StyledListItem>\n      </ul>\n\n      <StyledText>\n        The definition of{\" \"}\n        <StyledLink\n          href={\"https://en.wikipedia.org/wiki/Heat_capacity\"}\n          target={\"_blank\"}\n        >\n          Thermal Capacitance\n        </StyledLink>{\" \"}\n        (different than Thermal Conductance above) is the amount of heat energy\n        applied to an object to produce 1 degree of temperature change in it:\n      </StyledText>\n\n      <MathComponent\n        display={true}\n        tex={String.raw`C = \\lim_{\\Delta T \\to 0} \\frac{Q}{\\Delta T} = \\frac{dQ}{dT}`}\n      />\n\n      <ul>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`C`} /> is{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Heat_capacity\"}\n            target={\"_blank\"}\n          >\n            Thermal Capacitance\n          </StyledLink>{\" \"}\n          , or Heat Capacity, in Joules per degree Kelvin{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{J}{K}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`Q`} /> is heat\n          transferred in Joules{\" \"}\n          <MathComponent display={false} tex={String.raw`[J]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\Delta T`} /> is the\n          temperature difference in degrees{\" \"}\n          <MathComponent display={false} tex={String.raw`[K]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\frac{dQ}{dT}`} /> is\n          the rate of change of heat energy with respect to temperature in\n          Joules per degree{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{J}{K}]`} />\n        </StyledListItem>\n      </ul>\n\n      <StyledText>\n        Rearranging and differentiating the equation above with respect to time,\n        we obtain the following:\n      </StyledText>\n\n      <MathComponent display={true} tex={String.raw`q = C \\frac{dT}{dt}`} />\n\n      <ul>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`q`} /> is heat transfer\n          in Watts (i.e. Joules per second){\" \"}\n          <MathComponent display={false} tex={String.raw`[W = \\frac{J}{s}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`C`} /> is{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Heat_capacity\"}\n            target={\"_blank\"}\n          >\n            Thermal Capacitance\n          </StyledLink>{\" \"}\n          , or Heat Capacity, in Joules per degree Kelvin{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{J}{K}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\frac{dT}{dt}`} /> is\n          the derivative of temperature with respect to time in degrees per\n          second{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{K}{s}]`} />\n        </StyledListItem>\n      </ul>\n\n      <StyledText>\n        Note we now have two equations for{\" \"}\n        <MathComponent display={false} tex={String.raw`q`} />, heat transfer in\n        Watts. Equating these, working out the signs, and adding in power\n        generated or consumed, we obtain the following:\n      </StyledText>\n\n      <MathComponent\n        display={true}\n        tex={String.raw`C \\frac{dT}{dt} = \\sum{\\frac{\\Delta T}{R}} - q_{generated/consumed}`}\n      />\n\n      <ul>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`C`} /> is{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Heat_capacity\"}\n            target={\"_blank\"}\n          >\n            Thermal Capacitance\n          </StyledLink>{\" \"}\n          , or Heat Capacity, in Joules per degree Kelvin{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{J}{K}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\frac{dT}{dt}`} /> is\n          the derivative of temperature with respect to time in degrees per\n          second{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{K}{s}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\Delta T`} /> is the\n          temperature difference in degrees{\" \"}\n          <MathComponent display={false} tex={String.raw`[K]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`R`} /> is{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Thermal_resistance\"}\n            target={\"_blank\"}\n          >\n            Thermal Resistance\n          </StyledLink>{\" \"}\n          in degrees Kelvin per Watt{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{K}{W}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent\n            display={false}\n            tex={String.raw`q_{generated/consumed}`}\n          />{\" \"}\n          is the net heat generated or consumed, in Watts{\" \"}\n          <MathComponent display={false} tex={String.raw`[W]`} />\n        </StyledListItem>\n      </ul>\n\n      <StyledText>\n        This partial differential equation can be converted to a numerical\n        equation with reasonable results assuming the time step between discrete\n        states is small. In using thermalmodel.com, you&apos;ll notice that if\n        you increase the time step too much and rerun a model, unstable results\n        appear - at too high a time step size, errors compound at each step and\n        blow up the temperature differences to unreasonable numbers. If you see\n        instability, decrease the time step size and rerun your model.\n      </StyledText>\n\n      <StyledText>\n        Assuming small time steps, this equation holds for each node in the\n        model:\n      </StyledText>\n\n      <MathComponent\n        display={true}\n        tex={String.raw`\\Delta T_{node} = \\frac{\\Delta{t}}{C_{node}}(\\sum{\\frac{T_{other\\_node} - T_{node}}{R_{other\\_node \\leftrightarrow node}}} - q_{generated/consumed})`}\n      />\n\n      <ul>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\Delta{T}_{node}`} />{\" \"}\n          is the change in temperature of the node of interest at that time\n          step, in degrees{\" \"}\n          <MathComponent display={false} tex={String.raw`[K]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\Delta{t}`} /> is the\n          time step in seconds{\" \"}\n          <MathComponent display={false} tex={String.raw`[s]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`C_{node}`} /> is{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Heat_capacity\"}\n            target={\"_blank\"}\n          >\n            Thermal Capacitance\n          </StyledLink>{\" \"}\n          , or Heat Capacity, of the node of interest in Joules per degree\n          Kelvin{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{J}{K}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`T_{other\\_node}`} /> is\n          the current temperature of a node that is thermally connected with the\n          node of interest in degrees{\" \"}\n          <MathComponent display={false} tex={String.raw`[K]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`T_{node}`} /> is the\n          current temperature the node of interest in degrees{\" \"}\n          <MathComponent display={false} tex={String.raw`[K]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent\n            display={false}\n            tex={String.raw`R_{other\\_node \\leftrightarrow node}`}\n          />{\" \"}\n          is the{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Thermal_resistance\"}\n            target={\"_blank\"}\n          >\n            Thermal Resistance\n          </StyledLink>{\" \"}\n          between the two thermally connected nodes in degrees Kelvin per Watt\n          <MathComponent display={false} tex={String.raw`[\\frac{K}{W}]`} /> if\n          conduction or convection, or degrees Kelvin to the fourth per Watt\n          <MathComponent display={false} tex={String.raw`[\\frac{K^4}{W}]`} /> if\n          radiation\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent\n            display={false}\n            tex={String.raw`q_{generated/consumed}`}\n          />{\" \"}\n          is the net heat generated or consumed by the node of interest, in\n          Watts <MathComponent display={false} tex={String.raw`[W]`} />\n        </StyledListItem>\n      </ul>\n\n      <StyledText>\n        Under the hood, thermalmodel.com solves the above equation for each node\n        at each timestep, resulting in a set of temperature values for each node\n        at each timestep over the duration of the model.\n      </StyledText>\n\n      <StyledText>\n        Fixed temperature, i.e. boundary condition nodes do not change\n        temperature over time. They influence nodes that are thermally connected\n        to them, but their calculated temperature difference at each time step\n        is discarded rather than added to their previous temperature.\n      </StyledText>\n\n      <StyledText>\n        Nodes can be thermally connected through Conduction, Convection, or\n        Radiation. The user should calculate thermal resistance differently\n        depending on the type of connection, as follows:\n      </StyledText>\n\n      <MathComponent\n        display={true}\n        tex={String.raw`R_{conduction} = \\frac{L}{kA} \\quad \\text{units:} \\Big{[}\\frac{K}{W}\\Big{]}`}\n      />\n\n      <ul>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`L`} /> is the\n          conduction length, in meters{\" \"}\n          <MathComponent display={false} tex={String.raw`[m]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`k`} /> is the{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Thermal_conductivity\"}\n            target={\"_blank\"}\n          >\n            Thermal Conductivity\n          </StyledLink>\n          , in Watts per meter per degrees Kelvin{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{W}{mK}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`A`} /> is the\n          conduction area, in meters squared{\" \"}\n          <MathComponent display={false} tex={String.raw`[m^2]`} />\n        </StyledListItem>\n      </ul>\n\n      <MathComponent\n        display={true}\n        tex={String.raw`R_{convection} = \\frac{1}{hA} \\quad \\text{units:} \\Big{[}\\frac{K}{W}\\Big{]}`}\n      />\n\n      <ul>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`h`} /> is the{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Heat_transfer_coefficient\"}\n            target={\"_blank\"}\n          >\n            Convective Heat Transfer Coefficient\n          </StyledLink>\n          , in Watts per meters squared per degrees Kelvin{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{W}{m^2K}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`A`} /> is the\n          convection area, in meters squared{\" \"}\n          <MathComponent display={false} tex={String.raw`[m^2]`} />\n        </StyledListItem>\n      </ul>\n\n      <MathComponent\n        display={true}\n        tex={String.raw`R_{radiation} = \\frac{1}{\\epsilon \\sigma A} \\quad \\text{units:} \\Big{[}\\frac{K^4}{W}\\Big{]}`}\n      />\n\n      <ul>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\epsilon`} /> is the{\" \"}\n          <StyledLink\n            href={\"https://en.wikipedia.org/wiki/Emissivity\"}\n            target={\"_blank\"}\n          >\n            Emissivity\n          </StyledLink>\n          , a unit-less quantity\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`\\sigma`} /> is the{\" \"}\n          <StyledLink\n            href={\n              \"https://en.wikipedia.org/wiki/Stefan%E2%80%93Boltzmann_constant\"\n            }\n            target={\"_blank\"}\n          >\n            Stefan-Boltzmann constant\n          </StyledLink>\n          ,{\" \"}\n          <MathComponent display={false} tex={String.raw`5.67 \\cdot 10^{8}`} />{\" \"}\n          Watts per meters squared per degrees Kelvin to the fourth{\" \"}\n          <MathComponent display={false} tex={String.raw`[\\frac{W}{m^2K^4}]`} />\n        </StyledListItem>\n        <StyledListItem>\n          <MathComponent display={false} tex={String.raw`A`} /> is the radiation\n          area, in meters squared{\" \"}\n          <MathComponent display={false} tex={String.raw`[m^2]`} />\n        </StyledListItem>\n      </ul>\n\n      <StyledText>\n        In building your model, you&apos;re responsible for determining thermal\n        resistances between nodes, thermal capacitances of nodes, and power\n        generation or consumption in each node in your model. From there,\n        thermalmodel.com will do the rest.\n      </StyledText>\n\n      <StyledText>\n        The source code for the model can be seen{\" \"}\n        <StyledLink\n          href={\n            \"https://github.com/robinovitch61/thermalmodel.com/tree/main/packages/hotstuff-network\"\n          }\n          target={\"_blank\"}\n        >\n          here as a standalone Javascript package on npm\n        </StyledLink>\n        .\n      </StyledText>\n    </StyledTheoryModal>\n  );\n}\n","import * as React from \"react\";\nimport { useRef } from \"react\";\nimport { ModalState } from \"../../App\";\nimport styled from \"styled-components/macro\";\nimport useOnClickOutside from \"../../hooks/useOnClickOutside\";\nimport ConfirmationModal from \"./ConfirmationModal\";\nimport TheoryModal from \"./TheoryModal\";\nimport { StyledExitButton } from \"./style\";\n\nconst StyledModal = styled.div<{ visible: boolean }>`\n  font-size: 1.1em;\n  line-height: 1.4em;\n  position: absolute;\n  width: 80vw;\n  height: 90vh;\n  max-width: 1400px;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  margin: auto;\n  border: 3px solid black;\n  z-index: 10;\n  background: white;\n  display: ${(props) => (props.visible ? \"flex\" : \"none\")};\n  justify-content: center;\n  align-items: center;\n`;\n\nfunction getModalContent(\n  modalState: ModalState,\n  setModalState: React.Dispatch<React.SetStateAction<ModalState>>\n): React.ReactElement {\n  const type = modalState.type;\n\n  if (type === \"confirm\") {\n    return (\n      <ConfirmationModal\n        modalState={modalState}\n        setModalState={setModalState}\n      />\n    );\n  } else if (type === \"theory\") {\n    return <TheoryModal />;\n  } else {\n    return <h1>Coming Soon</h1>;\n  }\n}\n\ntype ModalProps = {\n  modalState: ModalState;\n  setModalState: React.Dispatch<React.SetStateAction<ModalState>>;\n};\n\nexport default function Modal(props: ModalProps): React.ReactElement {\n  const { modalState, setModalState } = props;\n\n  const modalRef = useRef<HTMLDivElement>(null);\n  useOnClickOutside(modalRef, () =>\n    setModalState((prev) => ({ ...prev, visible: false }))\n  );\n\n  const modalContent = getModalContent(modalState, setModalState);\n\n  return (\n    <StyledModal ref={modalRef} visible={modalState.visible}>\n      <StyledExitButton\n        onClick={() =>\n          setModalState((prevState) => ({\n            ...prevState,\n            visible: false,\n          }))\n        }\n      >\n        \n      </StyledExitButton>\n      {modalContent}\n    </StyledModal>\n  );\n}\n","import * as React from \"react\";\nimport { useEffect } from \"react\";\n\nexport default function useOnClickOutside(\n  ref: React.RefObject<HTMLDivElement>,\n  onClickOutside: () => void\n): void {\n  useEffect(() => {\n    const listener = (\n      event: React.MouseEvent | MouseEvent | React.TouchEvent | TouchEvent\n    ) => {\n      // Do nothing if clicking ref's element or descendent elements\n      if (!ref.current || ref.current.contains(event.target as Node | null)) {\n        return;\n      }\n      onClickOutside();\n    };\n    document.addEventListener(\"mousedown\", listener);\n    document.addEventListener(\"touchstart\", listener);\n    return () => {\n      document.removeEventListener(\"mousedown\", listener);\n      document.removeEventListener(\"touchstart\", listener);\n    };\n  }, [ref, onClickOutside]);\n}\n","import { HSConnection, HSNode, ModelOutput, run } from \"hotstuff-network\";\nimport React, { useCallback, useMemo, useState } from \"react\";\nimport { Point } from \"./utils/pointUtils\";\nimport Sidebar from \"./components/Sidebar/Sidebar\";\nimport Plot from \"./components/Plot/Plot\";\nimport config from \"./config\";\nimport useWindowSize from \"./components/Canvas/hooks/useWindowSize\";\nimport Canvas, { CanvasViewState } from \"./components/Canvas/Canvas\";\nimport useDraw from \"./hooks/useDraw\";\nimport useDoubleClick from \"./hooks/useDoubleClick\";\nimport useNodeConnectionUtils from \"./hooks/useNodeConnectionUtils\";\nimport useOnMouseDown from \"./hooks/useOnMouseDown\";\nimport useKeyDown from \"./hooks/useKeyDown\";\nimport { defaultAppState, defaultModalState } from \"./default\";\nimport useSessionStorageState from \"./hooks/useSessionStorageState\";\nimport { getCanvasCenter } from \"./components/Canvas/canvasUtils\";\nimport {\n  getNewAppNode,\n  getNewPossibleConnection,\n} from \"./utils/nodeConnectionUtils\";\nimport useAppStateModifiers from \"./hooks/useAppStateModifiers\";\nimport useResizablePanels from \"./hooks/useResizablePanels\";\nimport {\n  StyledApp,\n  StyledCanvas,\n  StyledHorizontalBorder,\n  StyledVerticalBorder,\n  StyledWorkspace,\n} from \"./style\";\nimport Modal from \"./components/Modal/Modal\";\nimport ErrorModal from \"./components/Modal/ErrorModal\";\nimport useTemporaryError from \"./components/Sidebar/hooks/useTemporaryError\";\n\nconst { plotMargin, tabHeightPx, plotHeightBufferPx } = config;\n\nexport type Direction = \"L\" | \"R\" | \"U\" | \"D\";\n\nexport type AppNode = HSNode & {\n  center: Point;\n  isActive: boolean;\n  textDirection: Direction;\n};\n\nexport type AppConnection = HSConnection & {\n  firstNodeId: string; // duplicated data here to make working with tables easier\n  secondNodeId: string; // duplicated data here to make working with tables easier\n};\n\nexport type Timing = {\n  timeStepS: number;\n  totalTimeS: number;\n};\n\nexport type PanelSizes = {\n  editorWidthFraction: number;\n  canvasHeightFraction: number;\n  tableHeightFraction: number;\n};\n\nexport type ModalType = \"theory\" | \"tutorial\" | \"about\" | \"confirm\";\n\nexport type ModalState = {\n  visible: boolean;\n  type: ModalType;\n  onConfirm?: () => void;\n  confirmText?: string[];\n};\n\nexport type AppState = {\n  timing: Timing;\n  nodes: AppNode[];\n  connections: AppConnection[];\n  canvasViewState: CanvasViewState;\n  savedCanvasState: CanvasViewState;\n  panelSizes: PanelSizes;\n};\n\nexport default function App(): React.ReactElement {\n  const [appState, setAppState] = useSessionStorageState<AppState>(\n    defaultAppState,\n    \"thermalModelAppState\"\n  );\n  const [output, setOutput] = useState<ModelOutput | undefined>(undefined);\n  const [modalState, setModalState] = useState<ModalState>(defaultModalState);\n  const [appErrors, setAppErrors, setTemporaryAppErrors] = useTemporaryError();\n\n  const [\n    setAppNodes,\n    setAppConnections,\n    setCanvasViewState,\n    setSavedCanvasState,\n    setTiming,\n  ] = useAppStateModifiers(setAppState, setOutput);\n\n  const [\n    addNode,\n    addConnection,\n    updateNodes,\n    deleteNodes,\n    updateConnections,\n    deleteConnections,\n    setActiveNodes,\n    clearActiveNodes,\n  ] = useNodeConnectionUtils(\n    appState.nodes,\n    setAppNodes,\n    appState.connections,\n    setAppConnections,\n    setOutput\n  );\n\n  const [keyboardActive, setKeyboardActive] = useState<boolean>(true);\n  useKeyDown(keyboardActive, appState.nodes, setAppNodes, deleteNodes);\n\n  const [draw, clearAndRedraw] = useDraw(appState.nodes, appState.connections);\n  const handleDoubleClick = useDoubleClick(\n    appState.nodes,\n    addNode,\n    updateNodes\n  );\n  const onMouseDown = useOnMouseDown(\n    appState.nodes,\n    appState.connections,\n    addConnection,\n    updateNodes,\n    setActiveNodes,\n    clearActiveNodes,\n    clearAndRedraw\n  );\n\n  const [size, ratio] = useWindowSize();\n  const [windowWidth, windowHeight] = size;\n\n  const [\n    canvasPlotBorderRef,\n    onMouseDownOnCanvasPlotBorder,\n    leftRightBorderRef,\n    onMouseDownOnLeftRightBorder,\n    tableControlsBorderRef,\n    onMouseDownOnTableControlsBorder,\n  ] = useResizablePanels(setAppState, windowHeight, windowWidth);\n\n  // width/heights\n  const workspaceWidth = windowWidth;\n  const workspaceHeight = windowHeight;\n  const canvasHeight = windowHeight * appState.panelSizes.canvasHeightFraction;\n  const canvasWidth =\n    windowWidth * (1 - appState.panelSizes.editorWidthFraction);\n  const plotHeight =\n    (1 - appState.panelSizes.canvasHeightFraction) * windowHeight -\n    tabHeightPx -\n    plotHeightBufferPx;\n  const plotWidth = canvasWidth;\n  const editorWidth = appState.panelSizes.editorWidthFraction * windowWidth;\n\n  const plot = useMemo(() => {\n    return (\n      <Plot\n        plotDimensions={{\n          height: plotHeight,\n          width: plotWidth,\n          margin: plotMargin,\n        }}\n        modelOutput={output}\n      />\n    );\n  }, [output, plotHeight, plotWidth]);\n\n  const addNodeInCenterOfCanvas = useCallback(() => {\n    addNode(\n      getNewAppNode(\n        appState.nodes,\n        getCanvasCenter(\n          canvasWidth,\n          canvasHeight,\n          appState.canvasViewState.offset,\n          appState.canvasViewState.scale\n        )\n      )\n    );\n  }, [\n    addNode,\n    appState.canvasViewState.offset,\n    appState.canvasViewState.scale,\n    appState.nodes,\n    canvasHeight,\n    canvasWidth,\n  ]);\n\n  const createNewLogicalConnection = useCallback(() => {\n    const newConnection = getNewPossibleConnection(\n      appState.nodes,\n      appState.connections\n    );\n    if (newConnection !== undefined) {\n      addConnection(newConnection);\n    }\n  }, [addConnection, appState.connections, appState.nodes]);\n\n  return (\n    <div>\n      <Modal modalState={modalState} setModalState={setModalState} />\n      <ErrorModal errors={appErrors} setErrors={setAppErrors} />\n      <StyledApp height={windowHeight} modalOpen={modalState.visible}>\n        <StyledHorizontalBorder\n          ref={canvasPlotBorderRef}\n          onMouseDown={onMouseDownOnCanvasPlotBorder}\n          y={appState.panelSizes.canvasHeightFraction}\n          width={1 - appState.panelSizes.editorWidthFraction}\n          left={0}\n        />\n        <StyledVerticalBorder\n          ref={leftRightBorderRef}\n          onMouseDown={onMouseDownOnLeftRightBorder}\n          x={1 - appState.panelSizes.editorWidthFraction}\n        />\n        <StyledHorizontalBorder\n          ref={tableControlsBorderRef}\n          onMouseDown={onMouseDownOnTableControlsBorder}\n          y={appState.panelSizes.tableHeightFraction}\n          width={appState.panelSizes.editorWidthFraction}\n          left={1 - appState.panelSizes.editorWidthFraction}\n        />\n\n        <StyledWorkspace\n          height={workspaceHeight}\n          width={(1 - appState.panelSizes.editorWidthFraction) * workspaceWidth}\n        >\n          <StyledCanvas height={canvasHeight}>\n            <Canvas\n              canvasWidth={canvasWidth}\n              canvasHeight={canvasHeight}\n              devicePixelRatio={ratio}\n              draw={draw}\n              onMouseDown={onMouseDown}\n              handleDoubleClick={handleDoubleClick}\n              canvasViewState={appState.canvasViewState}\n              setCanvasViewState={setCanvasViewState}\n              savedCanvasViewState={appState.savedCanvasState}\n              setSavedCanvasViewState={setSavedCanvasState}\n              setKeyboardActive={setKeyboardActive}\n              setModalState={setModalState}\n            />\n          </StyledCanvas>\n          {plot}\n        </StyledWorkspace>\n        <Sidebar\n          appState={appState}\n          setAppState={setAppState}\n          setOutput={setOutput}\n          setModalState={setModalState}\n          height={windowHeight}\n          width={editorWidth}\n          setTiming={setTiming}\n          onAddNode={addNodeInCenterOfCanvas}\n          onAddConnection={createNewLogicalConnection}\n          updateNodes={(nodes: AppNode[]) => {\n            updateNodes(nodes);\n            setOutput(undefined);\n          }}\n          deleteNodes={deleteNodes}\n          updateConnections={(conns: AppConnection[]) => {\n            updateConnections(conns);\n            setOutput(undefined);\n          }}\n          deleteConnections={deleteConnections}\n          onRunModel={() => {\n            const output = run({\n              nodes: appState.nodes,\n              connections: appState.connections,\n              timeStepS: appState.timing.timeStepS,\n              totalTimeS: appState.timing.totalTimeS,\n            });\n            if (output.errors?.length) {\n              setTemporaryAppErrors(output.errors.map((err) => err.message));\n            }\n            setOutput(output);\n            return output;\n          }}\n        />\n      </StyledApp>\n    </div>\n  );\n}\n","import * as React from \"react\";\n\nexport default function useSessionStorageState<T>(\n  defaultValue: T,\n  key: string\n): [T, React.Dispatch<React.SetStateAction<T>>] {\n  const [value, setValue] = React.useState<T>(() => {\n    const localState = window.sessionStorage.getItem(key);\n    if (localState === null || localState === undefined) {\n      return defaultValue;\n    } else {\n      return JSON.parse(localState) as T;\n    }\n  });\n\n  React.useEffect(() => {\n    window.sessionStorage.setItem(key, JSON.stringify(value));\n  }, [key, value]);\n  return [value, setValue];\n}\n","import * as React from \"react\";\nimport { useCallback } from \"react\";\nimport { CanvasViewState } from \"../components/Canvas/Canvas\";\nimport { ModelOutput } from \"hotstuff-network\";\nimport { AppConnection, AppNode, AppState, Timing } from \"../App\";\n\nexport default function useAppStateModifiers(\n  setAppState: React.Dispatch<React.SetStateAction<AppState>>,\n  setOutput: React.Dispatch<React.SetStateAction<ModelOutput | undefined>>\n): [\n  (newNodes: AppNode[]) => void,\n  (newConnections: AppConnection[]) => void,\n  (newCanvasState: CanvasViewState) => void,\n  (newCanvasState: CanvasViewState) => void,\n  (newTiming: Timing) => void\n] {\n  const setAppNodes = useCallback(\n    (newNodes: AppNode[]) => {\n      setAppState((prevState) => ({\n        ...prevState,\n        nodes: newNodes,\n      }));\n    },\n    [setAppState]\n  );\n\n  const setAppConnections = useCallback(\n    (newConnections: AppConnection[]) => {\n      setAppState((prevState) => ({\n        ...prevState,\n        connections: newConnections,\n      }));\n    },\n    [setAppState]\n  );\n\n  const setCanvasViewState = useCallback(\n    (newCanvasState: CanvasViewState) => {\n      setAppState((prevState) => ({\n        ...prevState,\n        canvasViewState: newCanvasState,\n      }));\n    },\n    [setAppState]\n  );\n\n  const setSavedCanvasState = useCallback(\n    (newSavedCanvasState: CanvasViewState) => {\n      setAppState((prevState) => ({\n        ...prevState,\n        savedCanvasState: newSavedCanvasState,\n      }));\n    },\n    [setAppState]\n  );\n\n  const setTiming = useCallback(\n    (newTiming: Timing) => {\n      setAppState((prevState) => ({\n        ...prevState,\n        timing: newTiming,\n      }));\n      setOutput(undefined);\n    },\n    [setAppState, setOutput]\n  );\n\n  return [\n    setAppNodes,\n    setAppConnections,\n    setCanvasViewState,\n    setSavedCanvasState,\n    setTiming,\n  ];\n}\n","import * as React from \"react\";\nimport { useCallback } from \"react\";\nimport { AppConnection, AppNode } from \"../App\";\nimport { ModelOutput } from \"hotstuff-network\";\n\nexport default function useNodeConnectionUtils(\n  appNodes: AppNode[],\n  setAppNodes: (newNodes: AppNode[]) => void,\n  appConnections: AppConnection[],\n  setAppConnections: (newConnections: AppConnection[]) => void,\n  setOutput: React.Dispatch<React.SetStateAction<ModelOutput | undefined>>\n): [\n  (node: AppNode) => void,\n  (connection: AppConnection) => void,\n  (nodesToUpdate: AppNode[], clearActiveNodes?: boolean) => void,\n  (nodeIds: string[]) => void,\n  (connsToUpdate: AppConnection[]) => void,\n  (connIds: string[]) => void,\n  (activeNodeIds: string[]) => void,\n  () => void\n] {\n  const addNode = useCallback(\n    (node: AppNode) => {\n      const newNodes = appNodes.map((node) => ({\n        ...node,\n        isActive: false,\n      }));\n      newNodes.push({ ...node, isActive: true });\n      setAppNodes(newNodes);\n      setOutput(undefined);\n    },\n    [appNodes, setAppNodes, setOutput]\n  );\n\n  const addConnection = useCallback(\n    (connection: AppConnection) => {\n      setAppConnections([...appConnections, connection]);\n      setOutput(undefined);\n    },\n    [appConnections, setAppConnections, setOutput]\n  );\n\n  const updateNodes = useCallback(\n    (nodesToUpdate: AppNode[], clearActiveNodes = false) => {\n      const newNodes = appNodes.map((node) => {\n        const nodeToUpdate = nodesToUpdate.find(\n          (newNode) => newNode.id === node.id\n        );\n        if (nodeToUpdate) {\n          return nodeToUpdate;\n        } else {\n          if (clearActiveNodes) {\n            return { ...node, isActive: false };\n          } else {\n            return node;\n          }\n        }\n      });\n      setAppNodes(newNodes);\n\n      const newConnections = appConnections.map((prevConn) => {\n        const newfirstNodeNode = nodesToUpdate.find(\n          (nodeToUpdate) => prevConn.firstNode.id == nodeToUpdate.id\n        );\n        if (newfirstNodeNode) {\n          return {\n            ...prevConn,\n            firstNode: newfirstNodeNode,\n            firstNodeId: newfirstNodeNode.id,\n          };\n        }\n\n        const newsecondNodeNode = nodesToUpdate.find(\n          (nodeToUpdate) => prevConn.secondNode.id == nodeToUpdate.id\n        );\n        if (newsecondNodeNode) {\n          return {\n            ...prevConn,\n            secondNode: newsecondNodeNode,\n            secondNodeId: newsecondNodeNode.id,\n          };\n        }\n        return prevConn;\n      });\n      setAppConnections(newConnections);\n    },\n    [appConnections, appNodes, setAppConnections, setAppNodes]\n  );\n\n  const deleteNodes = useCallback(\n    (nodeIds: string[]) => {\n      const newConnections = appConnections.filter(\n        (conn) =>\n          !nodeIds.includes(conn.firstNode.id) &&\n          !nodeIds.includes(conn.secondNode.id)\n      );\n      setAppConnections(newConnections);\n      setOutput(undefined);\n\n      const newNodes = appNodes.filter((node) => !nodeIds.includes(node.id));\n      setAppNodes(newNodes);\n    },\n    [appConnections, appNodes, setAppConnections, setAppNodes, setOutput]\n  );\n\n  const updateConnections = useCallback(\n    (connsToUpdate: AppConnection[]) => {\n      const sortedConnsToUpdate = connsToUpdate.map((conn) => {\n        const firstNodeFirst = conn.firstNode.name < conn.secondNode.name;\n        return {\n          ...conn,\n          firstNode: firstNodeFirst ? conn.firstNode : conn.secondNode,\n          firstNodeId: firstNodeFirst ? conn.firstNode.id : conn.secondNode.id,\n          secondNode: firstNodeFirst ? conn.secondNode : conn.firstNode,\n          secondNodeId: firstNodeFirst ? conn.secondNode.id : conn.firstNode.id,\n        };\n      });\n      const connIdsToUpdate = sortedConnsToUpdate.map((conn) => conn.id);\n      const oldConns = appConnections.filter(\n        (conn) => !connIdsToUpdate.includes(conn.id)\n      );\n      setAppConnections([...sortedConnsToUpdate, ...oldConns]);\n      setOutput(undefined);\n    },\n    [appConnections, setAppConnections, setOutput]\n  );\n\n  const deleteConnections = useCallback(\n    (connIds: string[]) => {\n      setAppConnections(\n        appConnections.filter((conn) => !connIds.includes(conn.id))\n      );\n      setOutput(undefined);\n    },\n    [appConnections, setAppConnections, setOutput]\n  );\n\n  const setActiveNodes = useCallback(\n    (activeNodeIds: string[]) => {\n      setAppNodes(\n        appNodes.map((node) => ({\n          ...node,\n          isActive: activeNodeIds.includes(node.id),\n        }))\n      );\n    },\n    [appNodes, setAppNodes]\n  );\n\n  const clearActiveNodes = useCallback(() => {\n    const anyActiveNodes = appNodes.find((node) => node.isActive) !== undefined;\n    if (anyActiveNodes) {\n      setAppNodes(\n        appNodes.map((node) => ({\n          ...node,\n          isActive: false,\n        }))\n      );\n    }\n  }, [appNodes, setAppNodes]);\n\n  return [\n    addNode,\n    addConnection,\n    updateNodes,\n    deleteNodes,\n    updateConnections,\n    deleteConnections,\n    setActiveNodes,\n    clearActiveNodes,\n  ];\n}\n","import React, { useEffect } from \"react\";\nimport { AppNode } from \"../App\";\n\nexport default function useKeyDown(\n  keyboardActive: boolean,\n  appNodes: AppNode[],\n  setAppNodes: (newNodes: AppNode[]) => void,\n  deleteNodes: (nodeIds: string[]) => void\n): void {\n  useEffect(() => {\n    const onKeyDown = (event: React.KeyboardEvent | KeyboardEvent) => {\n      if (keyboardActive) {\n        // meta + A makes all nodes active\n        if (event.metaKey && event.keyCode === 65) {\n          event.preventDefault();\n          setAppNodes(\n            appNodes.map((node) => {\n              return { ...node, isActive: true };\n            })\n          );\n        }\n\n        // delete active nodes on back/del\n        if (event.key === \"Backspace\" || event.key === \"Delete\") {\n          event.preventDefault();\n          deleteNodes(\n            appNodes.filter((node) => node.isActive).map((node) => node.id)\n          );\n        }\n\n        // escape key makes all inactive\n        if (event.keyCode === 27) {\n          setAppNodes(appNodes.map((node) => ({ ...node, isActive: false })));\n        }\n      }\n    };\n    document.addEventListener(\"keydown\", onKeyDown);\n    return () => document.removeEventListener(\"keydown\", onKeyDown);\n  }, [appNodes, deleteNodes, keyboardActive, setAppNodes]);\n}\n","import React, { useCallback } from \"react\";\nimport { CanvasState } from \"../components/Canvas/Canvas\";\nimport {\n  determineRadius,\n  intersectsCircle,\n  mouseToNodeCoords,\n  rotatedDirection,\n} from \"../components/Canvas/canvasUtils\";\nimport { AppNode } from \"../App\";\nimport { getNewAppNode } from \"../utils/nodeConnectionUtils\";\nimport config from \"../config\";\n\nexport default function useDoubleClick(\n  appNodes: AppNode[],\n  addNode: (node: AppNode) => void,\n  updateNodes: (nodes: AppNode[]) => void\n): (event: React.MouseEvent | MouseEvent, canvasState: CanvasState) => void {\n  return useCallback(\n    (event: React.MouseEvent | MouseEvent, canvasState: CanvasState) => {\n      event.preventDefault();\n      if (config.multiSelectKeys.some((k) => event[k])) {\n        return;\n      }\n\n      const nodeCoordsOfMouse = mouseToNodeCoords(event, canvasState);\n\n      const doubleClickedNode = appNodes.find((node) => {\n        const nodeRadius = determineRadius(\n          node.capacitanceJPerDegK,\n          appNodes.map((node) => node.capacitanceJPerDegK)\n        );\n        return intersectsCircle(nodeCoordsOfMouse, node.center, nodeRadius);\n      });\n\n      if (doubleClickedNode) {\n        updateNodes([\n          {\n            ...doubleClickedNode,\n            textDirection: rotatedDirection(doubleClickedNode.textDirection),\n          },\n        ]);\n      } else {\n        const newAppNode = getNewAppNode(appNodes, nodeCoordsOfMouse);\n        addNode(newAppNode);\n      }\n    },\n    [addNode, appNodes, updateNodes]\n  );\n}\n","import { useLayoutEffect, useState } from \"react\";\n\nexport default function useWindowSize(): [[number, number], number] {\n  const [size, setSize] = useState<[number, number]>([0, 0]);\n  const [ratio, setRatio] = useState(1);\n\n  useLayoutEffect(() => {\n    function updateSize() {\n      setSize([window.innerWidth, window.innerHeight]);\n    }\n    function updateRatio() {\n      const { devicePixelRatio: ratio = 1 } = window;\n      setRatio(ratio);\n    }\n    window.addEventListener(\"resize\", updateSize);\n    window.addEventListener(\"resize\", updateRatio);\n    updateSize();\n    updateRatio();\n    return () => {\n      window.removeEventListener(\"resize\", updateSize);\n      window.removeEventListener(\"resize\", updateRatio);\n    };\n  }, []);\n  return [size, ratio];\n}\n","export function forceShowScrollbars(): void {\n  // Returns whether scrollbars show up on scrollable elements.\n  // This is false on Macs when the \"General > Show scroll bars\" setting is\n  // not set to \"Always\" (the default is \"When scrolling\"). The approach\n  // taken here is to create an element that will scroll and then compare\n  // its outer width (including scrollbars) to its inner width (excluding\n  // scrollbars).\n  function areScrollbarsVisible() {\n    const scrollableElem = document.createElement(\"div\"),\n      innerElem = document.createElement(\"div\");\n    scrollableElem.style.width = \"30px\";\n    scrollableElem.style.height = \"30px\";\n    scrollableElem.style.overflow = \"scroll\";\n    scrollableElem.style.borderWidth = \"0\";\n    innerElem.style.width = \"30px\";\n    innerElem.style.height = \"60px\";\n    scrollableElem.appendChild(innerElem);\n    document.body.appendChild(scrollableElem); // Elements only have width if they're in the layout\n    const diff = scrollableElem.offsetWidth - scrollableElem.clientWidth;\n    document.body.removeChild(scrollableElem);\n    return diff > 0;\n  }\n\n  window.addEventListener(\"load\", function () {\n    // Show scrollbars if they're hidden.\n    if (!areScrollbarsVisible()) {\n      document.body.classList.add(\"force-show-scrollbars\");\n    }\n  });\n}\n","import * as React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport { forceShowScrollbars } from \"./utils/scrollBar\";\n\nforceShowScrollbars();\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}